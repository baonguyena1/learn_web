"use strict";function loginController(e,t,n,a,r,o,s,i,c,l){i.stop(),t.processing=!1,t.errologin="",t.$on("errologin",function(e,n){t.errologin=n}),t.result,t.disconnectServer="",t.linkTaskImg="./assets/img/icons/icn-congviec.png",t.linkProjectImg="./assets/img/icons/icn-project.png",t.linkReportImg="./assets/img/icons/icn-report.png",t.changeProjectImage=function(){t.linkTaskImg="./assets/img/icons/icn-congviec.png",t.linkProjectImg="./assets/img/icons/icn-highlight-project.png",t.linkReportImg="./assets/img/icons/icn-report.png"},t.changeTaskImage=function(){t.linkTaskImg="./assets/img/icons/icn-highlight-congviec.png",t.linkProjectImg="./assets/img/icons/icn-project.png",t.linkReportImg="./assets/img/icons/icn-report.png"},t.changeReportImage=function(){t.linkReportImg="./assets/img/icons/icn-report-highlight.png",t.linkTaskImg="./assets/img/icons/icn-congviec.png",t.linkProjectImg="./assets/img/icons/icn-project.png"},t.usernameEvent=function(){t.result=""},t.passwordEvent=function(){t.result=""},t.$on("event-error",function(e,n){t.error=!0,t.mgs_error=n}),t.login=function(){var e=t.username,a=t.password;if(!e&&!a)return void l.$broadcast("event-error","Tên đăng nhập và mật khẩu không được để trống");if(!e)return void l.$broadcast("event-error","Tên đăng nhập không được để trống");if(!a)return void l.$broadcast("event-error","Mật khẩu không được để trống");var r={username:e,password:a};t.processing=!0;var i=o.postMethod(c.METHOD,c.API,r,c.HEADERS);i.success(function(e){t.processing=!1;var a=$(window).width()/5,r=e.data.last_name+" "+e.data.middle_name+" "+e.data.first_name,o=r.length;r&&0!==r.length?(8*o>a&&(r=e.data.last_name+" "+e.data.middle_name[0]+". "+e.data.first_name),t.displayName=r):t.displayName=e.data.username,s.setRole(e.data.role),s.setUserName(t.displayName);var i=e.data.avatar;i&&0!==i.length?t.linkAvatar=i:t.linkAvatar="./assets/img/icons/default_avatar.png",s.setUserAvatar(t.linkAvatar),s.setCanCreateProject(e.data.can_create_project),s.setCanCreateMainTask(e.data.can_create_main_task);var c="";0!=e.data._id.length&&(c=e.data._id),s.setUserId(c),t.username=e.data.username;var l=e.data.access_token;s.setAccessToken(l),n.path("/dashboard/task-list")}).error(function(e){if(t.error=!0,e)if(e.errors&&e.errors.length>0){var n=e.errors[0];t.mgs_error=n.message}else t.mgs_error="Có lỗi xảy ra, vui lòng thử lại!";else t.mgs_error="Không kết nối được tới máy chủ, vui lòng thử lại";t.processing=!1})}}function logoutController(e,t,n,a,r,o,s){e.logout=function(){var e=a.getMethod(o.METHOD,o.API,o.HEADERS);e.success(function(e){r.removeAccessToken(),r.setObject(s.PROJECT_STAUS_KEY,null),r.setObject(s.TASK_STAUS_KEY,null),n.debug(e),t.path("/login")}).error(function(e){r.removeAccessToken(),n.debug(e)})}}function taskListController(e,t,n,a,r,o,s,i,c,l,u,d,p,m){function g(){l.start({message:"Đang tải dữ liệu..."});var n=i.getTasksList(c.METHOD,c.API,e.getParam(),c.HEADERS);n.success(function(n){var a=n.data.tasks;t.debug(a);r.innerWidth;0===a.length&&(e.noData=!0),e.tasks=a,e.page=_.page,e.totalItems=n.data.total,e.currentPage=_.page,e.numPages=Math.ceil(n.data.total/_.perPage),e.perPage=_.perPage,l.stop()})}function f(){0==_.page?e.offsetVal=0:e.offsetVal=(_.page-1)*_.perPage;var t={project:"",user:s.getUserId(),status:e.status_default.id,keyword:e.keyword||"",sort:e.sort_default.id,offset:e.offsetVal,limit:_.perPage};return t}function h(t){angular.equals(e.sort_default,t)||(e.sort_default=t,_.toPageId(1),e.getTask())}function k(t){e.noData=!1,angular.equals(e.status_default,t)||(e.status_default=t,s.setObject(p.TASK_STAUS_KEY,t),_.toPageId(1),e.getTask())}e.list_sort=d,e.list_status=u,e.sort_default=e.list_sort.normal;var _=null;e.$on("$viewContentLoaded",function(){var t=s.getObject(p.TASK_STAUS_KEY);t?e.status_default=t:e.status_default=e.list_status.working;var n=135,a=50,r=50,i=$(".main").height()-$(".top-menu").height()-$(".paging-menu").height()-a-r,c=Math.floor(i/n);c=0===c?1:c,_=o.getNew(2*c),e.offsetVal=0,e.noData=!1,e.getTask()}),e.currentPage,e.changePriority=h,e.changeStatus=k,e.getParam=f,e.getTask=g,e.dynamicPopover={content:"Hello, World!",templateUrl:"app/shared/layout/box-filter.html",title:"Title"},e.newTask="khuyentn",e.deleteTaskSuccess=!1;var v=s.getData();"delete-success"===v.key&&(e.deleteTaskSuccess=!0,e.message={type:"success",content:"Đã xóa công việc thành công!"}),e.isActive=function(e){var t=e===a.path();return t},e.$on("event-delete-success",function(t,n){e.delete_success=!0,e.mgs_success=n}),e.pageChanged=function(){_.toPageId(e.currentPage),e.getTask()}}function taskDetailController(e,t,n,a,r,o,s,i,c,l,u,d,p,m,g,f,h,k,_,v,y,D,T,b,S,E,w,I){function P(){w.start({message:"Đang tải dữ liệu..."}),$(".modal-dialog ").hide(),$(".modal-backdrop").hide();var t=u.getMethod(f.METHOD,Z,f.HEADERS);t.success(function(t){o.debug("task detail: "),o.debug(t.data),w.stop(),R(t.data.status),e.projectId=t.data.project._id,ne=l.API+e.projectId,ae=l.API+e.projectId+"/documents",t.data.owner._id===e.initUser&&(e.isOwner=!0);var n=t.data;e.taskDetail=$.extend(!0,{},n),e.validActionList=F(e.taskDetail.status),Y(),x();var a=new Date(n.plan_start_date);n.plan_start_date=convertDate(a);var r=new Date(n.plan_end_date);switch(n.plan_end_date=convertDate(r),n.priority){case 0:n.iconPriority="./assets/img/icons/tre_cin.png",n.namePriority="Thấp";break;case 1:n.iconPriority="./assets/img/icons/binhthuong_icn.png",n.namePriority="Bình Thường";break;case 2:n.iconPriority="./assets/img/icons/cao_icn.png",n.namePriority="Cao";break;case 3:n.iconPriority="./assets/img/icons/khancap_icn.png",n.namePriority="Khẩn Cấp";break;default:n.iconPriority="./assets/img/icons/tre_cin.png",n.namePriority="Độ Ưu Tiên"}switch(n.dependency){case 1:n.iconLock="./assets/img/icons/lock-icon.png",$("#img_icn_task_lock").show();break;case 2:n.iconLock="./assets/img/icons/icn_unlock.png",$("#img_icn_task_lock").show();break;default:$("#img_icn_task_lock").hide()}e.taskInformation=n,e.taskInformation.can_change?e.isOwner=!0:e.isOwner=!1,U();var s={keyword:""};q=D.API+e.taskInformation.project._id+"/members";var i=p.getTasksList(D.METHOD,q,s,D.HEADERS);i.success(function(t){e.membersProject=t.data}),e.reloadComments()}).error(function(e){w.stop(),s.path("/login")})}function A(){if(J=0==e.pages?0:e.pages*e.limit,!(J<e.comments.length)){e.shouldLoadComment=!1;var t={offset:J,limit:e.limit},n=p.getTasksList(k.METHOD,Q,t,k.HEADERS);n.success(function(t){var n,a=70,r=[];e.total=t.data.total;var o=t.data.comments;e.autoScroll(o.length*a),o.length<e.limit&&(e.shouldLoadComment=!1);for(var s=0;s<o.length;s++){n=void 0;for(var i=0;i<r.length;i++)if(o[s].user.avatar===r[i]){n=!0;break}n||r.push(o[s].user.avatar),console.log(o),e.comments.push(o[s])}e.commentsDisplay=K(o,e.commentsDisplay),e.avatars=r,e.shouldLoadComment=!0}).error(function(t){e.shouldLoadComment=!0})}}function C(){var t=p.getTasksList(v.METHOD,te,e.getParam(),v.HEADERS);t.success(function(t){e.childrenTasks=t.data.tasks;for(var n=0;n<e.childrenTasks.length;n++){re(e.childrenTasks[n].plan_end_date)}e.page=e.pageInfo.page,e.totalItems=t.data.total,e.currentPage=e.pageInfo.page,e.numPages=Math.ceil(t.data.total/e.pageInfo.perPage),e.perPage=e.pageInfo.perPage}).error(function(e){o.debug(e)})}function O(){0==e.pageInfo.page?e.offsetVal=0:e.offsetVal=(e.pageInfo.page-1)*e.pageInfo.perPage;var t={offset:e.offsetVal,limit:e.pageInfo.perPage};return t}function M(e){e.disabled||j(e)}function j(t){var a={action:t.id},r=d.postMethod(y.METHOD,e.updatePriorityUrl,a,y.HEADERS);r.success(function(e){P()}).error(function(t){if(t)if(t.errors&&t.errors.length>0){var a=t.errors[0];e.alerts.push({type:"danger",message:a.message})}else e.alerts.push({type:"danger",message:"Có lỗi xảy ra, vui lòng thử lại!"});else e.alerts.push({type:"danger",message:"Không kết nối được tới máy chủ, vui lòng thử lại!"});n(function(){e.error=!1,e.mgs_error=""},5e3)})}function R(t){0===t?e.status_task_default=e.status_task.new:1===t?e.status_task_default=e.status_task.inprogress:2===t?e.status_task_default=e.status_task.finish:3===t?e.status_task_default=e.status_task.reopen:4===t?e.status_task_default=e.status_task.cancel:5===t&&(e.status_task_default=e.status_task.hold),o.debug(JSON.stringify(e.status_task_default))}function U(){e.iconRunner="./assets/img/icons/icn-run-process.png",e.hidenPerson=!1,e.percentCompletedReal=0,e.percentlated=0,e.percentPerson=0,e.hiden_current_date=!0;var t=e.taskInformation,n=new Date(t.plan_start_date),a=new Date(t.plan_end_date),r=new Date(t.real_start_date),o=new Date(t.real_end_date),s=(n.getTime(),a.getTime()),i=L(a,n),c=r.getTime(),l=o.getTime();if(2==t.status)return e.percentCompleted=100,e.iconRunner="./assets/img/icons/veDich_x3.png",e.percentlated=0,e.percentPerson=100,e.showPercent=!0,void(e.percentCompletedReal=100);if(isNaN(c))return e.percentCompleted=0,void(e.hidenPerson=!0);if(s>c){var u=L(r,n),d=u/i*100;isNaN(l)||(t.plan_end_date=o,e.iconRunner="./assets/img/icons/veDich_x3.png",d=100),e.percentPerson=e.percentCompleted=Math.ceil(d),e.showPercent=!0,e.percentCompletedReal=e.percentPerson}else{var p=Math.floor((c-s)/864e5);if(0===p)return e.percentCompleted=50,e.percentlated=50,e.iconRunner="./assets/img/icons/icn-run-process-ending.png",e.percentPerson=50,void(e.showPercent=!1);if(!isNaN(l))return e.percentCompleted=50,e.percentlated=100,e.iconRunner="./assets/img/icons/veDich_x3.png",e.percentPerson=100,e.showPercent=!0,void(e.percentCompletedReal=100);e.percentCompleted=50,e.percentlated=75,e.iconRunner="./assets/img/icons/icn-run-process-ending.png",e.percentPerson=75,e.showPercent=!1}}function L(e,t){var n=Math.abs(e.getTime()-t.getTime()),a=Math.ceil(n/864e5);return a}function H(e){var t=$(".nano-content"),n=t.get(0),a=0;a=e?e:t.get(0).scrollHeight,$(n).animate({scrollTop:a},"800","swing")}function N(e,t){e.setHours(0,0,0,0),t.setHours(0,0,0,0);var n=e.getTime()-t.getTime();return Math.ceil(n/864e5)}function x(){var t=e.taskDetail,n=t.status,a=t.plan_end_date,r=null,o=null;switch(e.runningMan.showPercent=!0,e.showProgressBar=!1,n){case b.INPROGERSS:case b.HOLD:o=t.real_start_date,e.showProgressBar=!0,e.runningMan.icon="./assets/img/icons/running-man-processing.png",e.runningMan.date=new Date,B(a,o,new Date),t.children_task&&t.children_task>0?(e.runningMan.showPercent=!0,e.runningMan.percent=t.percent_completed):e.runningMan.showPercent=!1;break;case b.DONE:e.runningMan.showPercent=!0,e.showProgressBar=!0,o=t.real_start_date,r=t.real_end_date,e.runningMan.percent=100,e.runningMan.icon="./assets/img/icons/running-man-finished.png",e.runningMan.date=t.real_end_date,B(a,o,r)}}function B(t,n,a){if(!t||!n||!a)return void(e.showProgressBar=!1);var r=10,o=[t,n,a],s=new Date(Math.max.apply(null,o)),i=new Date(Math.min.apply(null,o)),c=N(s,i);c=Math.abs(c);var l=N(t,a),u=new Date(Math.min.apply(null,[a,t])),d=N(u,n),p=N(a,t);l=l>0?l:0,d=d>0?d:0,p=p>0?p:0;var m=W(l,c),g=W(d,c),f=W(p,c);e.newBarInfo.width=Math.floor(100*m),e.inprogressBarInfo.width=Math.floor(100*g),e.lateBarInfo.width=Math.floor(100*f),0===c&&(n<=t?e.inprogressBarInfo.width=100:e.lateBarInfo.width=100),z(e.newBarInfo),z(e.inprogressBarInfo),z(e.lateBarInfo);var h=10,k=$(".task-progress-bar").width()-h;if(e.lateBarInfo.show){if(e.taskDetail.status!==b.DONE&&(e.runningMan.icon="./assets/img/icons/running-man-late.png"),e.lateBarInfo.width<r&&(e.lateBarInfo.width=r,e.inprogressBarInfo.width=100-e.lateBarInfo.width),e.inprogressBarInfo.show)e.inprogressBarInfo.showEndColumn=!1,e.inprogressBarInfo.width<r&&(e.inprogressBarInfo.width=r,e.lateBarInfo.width=100-e.inprogressBarInfo.width),e.barFooterInfo.leftPosition=e.inprogressBarInfo.width*k/100-h;else{var _=-2e3;e.barFooterInfo.leftPosition=_}e.runningMan.barWidth=100}else{if(e.inprogressBarInfo.show){e.newBarInfo.showBeginColumn=!1,e.inprogressBarInfo.width<r&&(e.inprogressBarInfo.width=r,e.newBarInfo.width=100-e.inprogressBarInfo.width),e.newBarInfo.show&&e.newBarInfo.width<r&&(e.newBarInfo.width=r,e.inprogressBarInfo.width=100-e.newBarInfo.width);e.runningMan.barWidth=e.inprogressBarInfo.width}else e.newBarInfo.showBeginColumn=!0,$(".new-column.begin-bar-column").css("background","black"),e.runningMan.showRight=!1;k=$(".task-progress-bar").width()-2*h,e.barFooterInfo.leftPosition=k}}function W(e,t){var n=0;return t>0&&(n=(e/t).toFixed(2)),n}function z(e){0===e.width&&(e.show=!1,e.showBeginColumn=!1,e.showEndColumn=!1)}function Y(){e.taskDetail.plan_end_date&&(e.taskDetail.plan_end_date=new Date(e.taskDetail.plan_end_date)),e.taskDetail.plan_start_date&&(e.taskDetail.plan_start_date=new Date(e.taskDetail.plan_start_date)),e.taskDetail.real_end_date&&(e.taskDetail.real_end_date=new Date(e.taskDetail.real_end_date)),e.taskDetail.real_start_date&&(e.taskDetail.real_start_date=new Date(e.taskDetail.real_start_date))}function F(t){var n=[];switch(t){case b.NEW:n=[e.action_task.start,e.action_task.finish,e.action_task.hold,e.action_task.cancel];break;case b.INPROGERSS:n=[e.action_task.finish,e.action_task.hold,e.action_task.cancel];break;case b.DONE:n=[e.action_task.reopen];break;case b.REOPEN:n=[e.action_task.start,e.action_task.finish,e.action_task.hold,e.action_task.cancel];break;case b.CANCEL:n=[e.action_task.reopen];break;case b.HOLD:n=[e.action_task.reopen,e.action_task.finish,e.action_task.cancel]}return n}function K(e,t){return t=t?t:[],e&&e.forEach(function(e){if(console.log(e.message),2===e.comment_type&&(e.message_report="Báo cáo tuần "+e.week_number+"/"+e.year),0===t.length)t.splice(0,0,G(e));else for(var n=t.length-1;n>=0;n--){var a=t[n];if(moment(e.comment_date).isAfter(moment(a.date),"day")){t.splice(n+1,0,G(e));break}if(moment(e.comment_date).isSame(moment(a.date),"day")){a.comments.push(e);break}0===n&&t.splice(n,0,G(e));break}}),t}function G(e){var t=null;return e&&(t={date:e.created_at,dateString:moment(e.comment_date).format("dddd, DD/MM/YYYY"),comments:[e]}),t}function V(t,n){if(t){var a=T.API+"/"+X+"/comments/"+n,r=m.deleteMethod(T.METHOD,a,T.HEADERS);r.success(function(t){e.alerts.push({type:"success",message:"Xoá báo cáo thành công!"}),e.reloadComments()}).error(function(t){t?t.errors&&t.errors.length>0?e.alerts.push({type:"danger",message:t.errors[0].message}):e.alerts.push({type:"danger",message:"Có lỗi xảy ra, vui lòng thử lại!"}):e.alerts.push({type:"danger",message:"Không kết nối được tới máy chủ, vui lòng thử lại!"})})}}e.$on("event-error",function(t,n){e.error=!0,e.mgs_error=n}),e.template_default={url:"app/components/projects/document-list.html"},e.template_list=[{url:"app/components/projects/document-list.html"},{url:"app/components/projects/document-list.html"}],e.barFooterInfo={leftPosition:0},e.actionMode=S,e.showProgressBar=!1,e.shouldLoadComment=!0,e.currentdate=new Date,e.percentCompleted=0,e.comments=[],e.displayComments=[],e.commentsTemp=[],e.selectedItem,e.selectedMember="",e.selectedOwner,e.statusAssign,e.messageAssign,e.getParam=O,e.currentPage,e.isOwner=!1,e.statusSelected=M,e.getComments=A,e.projectId="",e.getChildrenTask=C,e.dynamicPopover={content:"Hello, World!",templateUrl:"app/components/tasks/assign-task.html",title:"Title",status:!1},e.commentMenu={content:"Hello, World!",templateUrl:"commentMenu.html",title:"Title",status:!1},e.type="task",e.autoScroll=H,e.total=0;e.limit=5;var J,q,X=a.idTask,Z=f.API+X,Q=k.API+X+"/comments",ee=_.API+X+"/comments",te=v.API+X+"/children-task/";e.updatePriorityUrl=y.API+X,e.initUser=g.getUserId(),e.taskId=X,e.pages=0,e.newComent;var ne="",ae="";e.barWidthInfo={lateBarWidth:0,newBarWidth:0,inprogressBarWidth:0},e.runningMan={percent:0,date:"10/10/2015",icon:"./assets/img/icons/running-man-finished.png",marginLeft:0,showRight:!0,barWidth:0},e.alerts=[],e.newBarInfo={width:0,show:!0,showBeginColumn:!0,showEndColumn:!0},e.inprogressBarInfo={width:0,show:!0,showBeginColumn:!0,showEndColumn:!0},e.lateBarInfo={width:0,show:!0,showBeginColumn:!0,showEndColumn:!0},e.tabs=[{title:"Chi tiết",url:"chitiet"},{title:"Công văn",url:"congvan"},{title:"Tác vụ con",url:"tacvucon"}],e.priorities=[{name:"Thấp",urlIcon:"./assets/img/icons/tre_cin.png",id:0},{name:"Bình Thường",urlIcon:"./assets/img/icons/binhthuong_icn.png",id:1},{name:"Cao",urlIcon:"./assets/img/icons/cao_icn.png",id:2},{name:"Khẩn Cấp",urlIcon:"./assets/img/icons/khancap_icn.png",id:3}],e.status_task={new:{icon:"./assets/img/icons/new_status.png",name:"Mới",id:0},inprogress:{icon:"./assets/img/icons/inprogress_status.png",name:"Đang làm",id:1},finish:{icon:"./assets/img/icons/done_status.png",name:"Hoàn thành",id:2},reopen:{icon:"./assets/img/icons/reopen_status.png",name:"Làm lại",status_name:"Mở lại",id:3},cancel:{icon:"./assets/img/icons/cancel_status.png",name:"Huỷ",id:4},hold:{icon:"./assets/img/icons/pause_status.png",name:"Tạm dừng",status_name:"Đang làm",id:5}},e.action_task={start:{icon:"./assets/img/icons/start_action.png",name:"Bắt đầu",id:0},finish:{icon:"./assets/img/icons/done_action.png",name:"Hoàn thành",id:1},reopen:{icon:"./assets/img/icons/reopen_action.png",name:"Làm lại",id:2},cancel:{icon:"./assets/img/icons/cancel_action.png",name:"Huỷ",id:3},hold:{icon:"./assets/img/icons/pause_action.png",name:"Tạm dừng",id:4}},e.validActionList=null,e.$on("$viewContentLoaded",function(){e.currentTab="chitiet",P(),e.pageInfo=h.getNew(3),e.getChildrenTask()}),e.disabledStatus=[2,4,5],e.checkStatus=function(t){return e.disabledStatus.indexOf(t)!==-1};var re=function(e){var t,n,a=new Date,r=new Date(a).getTime()-new Date(e).getTime(),o=Math.ceil(r/864e5);if(t=r<=0?"Còn ":"Đã trễ ",n=Math.abs(o),n<1)return t+n+" giờ";if(n>=1&&n<=30)return t+n+" ngày";if(n>30&&n<=365){var s=Math.round(n/30);return t+s+" tháng"}if(n>365){var i=Math.round(n/365);return t+i+" năm"}};e.onClickTab=function(t){e.custom=!0,e.currentTab=t.url,e.template_default=e.template_list[1]},e.isActiveTab=function(t){return t==e.currentTab},e.viewReport=function(){console.log("Show report detail")},e.deleteReport=function(){console.log("Show report detail")},e.custom=!0,e.selectAssigner=function(){};var oe=null;e.selectMember=function(t){null!==oe&&(oe.selectedMember=""),oe=t,oe.selectedMember="circle-prior-normal",e.selectedOwner=oe},e.noHidden=function(){e.custom=!0},e.unselectMember=function(e){e.selectedMember=""},e.$on("selected-assign-work",function(t,n){n?(P(),e.alerts.push({type:"success",message:"Giao việc thành công"})):e.alerts.push({type:"danger",message:"Có lỗi trong quá trình giao việc, vui lòng thử lại!"})}),e.sendComment=function(t){var n={comment:t},a=d.postMethod(_.METHOD,ee,n,_.HEADERS);a.success(function(n){e.newComent={message:t,user:{avatar:g.getUserAvatar(),_id:e.initUser},created_at:(new Date).toISOString()},e.newComent&&(e.taskInformation.can_delete=!1),e.avatars.indexOf(g.getUserAvatar())<0&&e.avatars.push(g.getUserAvatar()),e.commentsDisplay=K([e.newComent],e.commentsDisplay),e.comments.push(e.newComent),e.autoScroll()}).error(function(e){o.debug(e)}),e.contentComment=""},e.prioritySelected=function(t){e.selectedItem=t;var n=t.id,a={priority:n},r=d.postMethod(y.METHOD,e.updatePriorityUrl,a,y.HEADERS);r.success(function(t){e.taskInformation.iconPriority=e.priorities[n].urlIcon,e.taskInformation.namePriority=e.priorities[n].name}).error(function(t){t?t.errors&&t.errors.length>0?e.alerts.push({type:"danger",message:t.errors[0].message}):e.alerts.push({type:"danger",message:"Có lỗi xảy ra, vui lòng thử lại!"}):e.alerts.push({type:"danger",message:"Không kết nối được tới máy chủ, vui lòng thử lại!"})})},e.addDocument=function(t){c.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/add-document.html",controller:"ModalAddDocumentCtrl",controllerAs:"$ctrl",scope:e,size:t,resolve:{items:function(){return e.taskId},documentFor:function(){return 1},documents:function(){return e.listDocuments},method:function(){return""},data:function(){return{}}}})},e.reportAction=function(t,n){c.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/components/reports/weekly-report.html",controller:"weeklyReportController",resolve:{taskInfo:function(){return{title:e.taskInformation.title,_id:e.taskInformation._id,project:e.taskInformation.project.name}},reportInfo:function(){return t},actionMode:function(){return n}}})},e.openConfirmBox=function(e){c.open({templateUrl:"app/shared/layout/confirm-dialog.html",controller:"ConfirmDialogController",resolve:{callback:function(){return V},data:function(){return{title:"Sunware",body:"Bạn có muốn xoá báo cáo này?",extra:e}}}})},e.openMemberBox=function(t){return!(e.disabledStatus.indexOf(status)>=0)&&void c.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"Người thực hiện"},popupType:function(){return t},canSearch:function(){return!0},multipleSelect:function(){return!1},selectedItems:function(){return e.selectedAssignees},extraData:function(){return{projectId:e.idProject}}}})},e.closeAlert=function(t){e.alerts.splice(t,1)},e.openBox=function(t,n){if(e.disabledStatus.indexOf(n)>=0)return!1;c.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/box-list-user.html",controller:"ModalInstanceCtrl",controllerAs:"$ctrl",resolve:{projectId:function(){return e.projectId},selectedMember:function(){return"supervisor"===t?e.selectedSupervisor:e.selectedAssignee},type:function(){return t},taskId:function(){return e.taskId},selectedOrgs:function(){return""},selectedDependencyTasks:function(){return""},parentId:function(){return null}}})},e.removeTask=function(e){var n=T.API+"/"+e;if(confirm("Bạn có chắc muốn xóa công việc này?")){var a=m.deleteMethod(T.METHOD,n,T.HEADERS);a.success(function(e){g.setData("delete-success",e.data),r.go("dashboard/task-list")}).error(function(e){null===e&&t.$broadcast("event-error","Xóa tác vụ thất bại. Hãy kiểm tra kết nối mạng!")})}},e.pageChanged=function(){e.pageInfo.toPageId(e.currentPage),e.getChildrenTask()},t.$on("create-weekly-report-sucess",function(t,n){e.alerts.push({type:"success",message:"Tạo báo cáo thành công!"}),e.reloadComments()}),t.$on("edit-weekly-report-sucess",function(t,n){e.alerts.push({type:"success",message:"Cập nhật báo cáo thành công!"}),e.reloadComments()}),e.reloadComments=function(){e.pages=0,e.comments=[],e.commentsDisplay=[],e.getComments()},e.loadMoreComment=function(){e.shouldLoadComment&&(e.pages++,e.numberPage=Math.ceil(e.total/e.limit),e.pages<e.numberPage&&e.getComments())}}function projectListController(e,t,n,a,r,o,s,i,c,l,u){function d(){s.start({message:"Đang tải dữ liệu..."});var n=a.getTasksList(o.METHOD,o.API,g(),o.HEADERS);n.success(function(n){var a=n.data.projects;t.debug(n),e.projects=a,e.totalItems=n.data.total,e.currentPage=f.page,e.perPage=f.perPage,0==e.projects.length?e.noData=!0:e.noData=!1,s.stop()}).error(function(e){s.stop()})}function p(t){angular.equals(e.sort_default,t)||(console.log(JSON.stringify(t)),e.sort_default=t,f.toPageId(1),e.getGetProjects())}function m(t){angular.equals(e.status_default,t)||(r.setObject(u.PROJECT_STAUS_KEY,t),e.status_default=t,f.toPageId(1),e.getGetProjects())}function g(){0==f.page?e.offsetVal=0:e.offsetVal=(f.page-1)*f.perPage;var t={project:"",owners:"",status:e.status_default.id,keyword:e.keyword||"",sort:e.sort_default.id,offset:e.offsetVal,limit:f.perPage};return t}var f=null;e.$on("$viewContentLoaded",function(){var t=135,a=50,o=50,s=$(".main").height()-$(".top-menu").height()-a-o,i=Math.floor(s/t);i=0===i?1:i,f=n.getNew(2*i),e.offsetVal=0;var c=r.getObject(u.PROJECT_STAUS_KEY);c?e.status_default=c:e.status_default=e.list_status.working,e.getGetProjects()}),e.createProject=!1;var h=r.getData();"new-project"===h.key&&(e.new_task=h.value,e.createProject=!0,e.message={type:"success",content:'Dự án <a class="cursor-pointer" ng-href="#/dashboard/projects/'+e.new_task._id+'/thongtin"><strong>'+e.new_task.name+"</strong></a> đã được tạo thành công!"}),e.currentPage,e.noData=!1,e.canCreateProject=r.getCanCreateProject();e.getParam=g,e.getGetProjects=d,e.list_status=angular.copy(c),delete e.list_status.late,e.list_sort=l,e.sort_default=e.list_sort.name,e.changeStatus=m,e.changePriority=p,e.clickTask=function(){},e.pageChanged=function(){f.toPageId(e.currentPage),e.getGetProjects()},e.disable=function(){return!1}}function projectDetailController(e,t,n,a,r,o,s,i,c,l,u,d,p,m,g){function f(t,n){if(t){var a=c.API+n,r={description:"do some thing"},o=m.postMethod("PUT",a,r);o.success(function(){e.alertsMsg={type:"success",message:"Hủy dự án thành công!"}}).error(function(){e.alertsMsg={type:"danger",message:"Không thể hủy dự án vui lòng kiểm tra lại!"}}),g(function(){e.alertsMsg=null},1e3)}}function h(){var t=i.getTasksList(l.METHOD,y,e.getParam(),l.HEADERS);t.success(function(t){e.tasksProject=t.data.tasks,e.totalItems=t.data.total,e.numPages=Math.ceil(t.data.total/e.pageInfo.perPage),e.perPage=e.pageInfo.perPage}).error(function(e){n.debug(e)})}function k(){0==e.currentPage?e.offsetVal=0:e.offsetVal=(e.currentPage-1)*e.pageInfo.perPage;var t={offset:e.offsetVal,limit:e.pageInfo.perPage};return t}var _=t.idProject,v=c.API+_,y=l.API+_+"/tasks";c.API+_+"/documents";e.getParam=k,e.getTaskProject=h,e.pageInfo=r.getNew(2),e.noData=!1,e.projectId=_,e.name_owners="",e.position_name="",e.type="project",e.currentPage=0,e.currentTab=t.nameTab?t.nameTab:"thongtin",e.canCreateMainTask=o.getCanCreateMainTask(),e.$on("$viewContentLoaded",function(){u.start({message:"Đang tải dữ liệu..."}),e.getTaskProject();var t=s.getMethod(c.METHOD,v,c.HEADERS);t.success(function(t){u.stop(),e.projectInfomation=t.data,n.debug(e.projectInfomation),0==e.projectInfomation.length&&(e.noData=!0),e.percentComplete=e.projectInfomation.percent_completed,e.projectInfomation.percentComplete=e.percentComplete;var a=$(".name-project-manager").width(),r=[];r.push(e.projectInfomation.owner.last_name),r.push(e.projectInfomation.owner.middle_name),r.push(e.projectInfomation.owner.first_name);var o=r.join(" ").length,s=[];s.push(e.projectInfomation.owner.last_name),8*o>a?s.push(e.projectInfomation.owner.middle_name[0]+"."):s.push(e.projectInfomation.owner.middle_name),s.push(e.projectInfomation.owner.first_name),e.name_owners=s.join(" "),e.position_name=e.projectInfomation.owner.position.name,e.positionNameLength=a/8-3}).error(function(e){n.debug(e),u.stop(),a.path("/login")})}),e.openConfirmBoxCancelProject=function(e){p.open({templateUrl:"app/shared/layout/confirm-dialog.html",controller:"ConfirmDialogController",resolve:{callback:function(){return f},data:function(){return{title:"Sunware",body:"Bạn có muốn hủy dự án này?",extra:e}}}})},e.projectTabs=[{title:"Tác vụ",icon:"./assets/img/icons/icn-choose-major-task.png",icon_highlight:"./assets/img/icons/icn-Task-detail-highlight-tab.png",url:"tacvu"},{title:"Thông tin",icon:"./assets/img/icons/icn-information-tab.png",icon_highlight:"./assets/img/icons/icn-information-highlight-tab.png",url:"thongtin"},{title:"Công văn",icon:"./assets/img/icons/icn-paragraph-tab.png",icon_highlight:"./assets/img/icons/icn-paragraph-highlight-tab.png",url:"vanban"}],e.onClickTab=function(t){e.currentTab=t.url},e.isActiveTab=function(t){return t==e.currentTab},e.currentIcon=function(t){return e.isActiveTab(t.url)?t.icon_highlight:t.icon},e.pageChanged=function(){e.pageInfo.toPageId(e.currentPage),e.getTaskProject()},e.animationsEnabled=!0,e.open=function(t){p.open({animation:e.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/add-document.html",controller:"ModalAddDocumentCtrl",controllerAs:"$ctrl",size:t,resolve:{items:function(){return _},documentFor:function(){return 0},documents:function(){return 0},method:function(){return"add"},data:function(){return{}}}})}}function ModalAddDocumentCtrl(e,t,n,a,r,o,s,i,c,l,u,d,p){function m(e){var t=e.date,n=e.mode;if("day"===n)for(var a=new Date(t).setHours(0,0,0,0),o=0;o<r.events.length;o++){var s=new Date(r.events[o].date).setHours(0,0,0,0);if(a===s)return r.events[o].status}return""}function g(e){}function f(){_.submiting=!0,r.error=!1,$("body").css("cursor","wait");var n=null,c=null;r.organizations&&r.organizations.length>0&&(n=r.organizations[0]._id,c=r.organizations[0].name);var l={issuer:_.issuer?_.issuer:c,description:_.description,document_number:_.document_number,publish_date:_.publish_date,type:parseInt(_.type),organization:n,owner:""};if("edit"===d){_.iUrl=i.API+p._id;var u=o.postMethod(i.METHOD,_.iUrl,l,i.HEADERS);u.success(function(t){_.submiting=!1,$("body").css("cursor","pointer"),e.dismiss("cancel"),a.$broadcast("reload-list-document")}).error(function(e){$("body").css("cursor","pointer"),_.submiting=!1,console.log("error add document"),h(e)})}else{var u=o.postMethod(s.METHOD,_.iUrl,l,s.HEADERS);u.success(function(t){_.submiting=!1,$("body").css("cursor","pointer"),e.dismiss("cancel"),a.$broadcast("reload-list-document")}).error(function(e){$("body").css("cursor","pointer"),_.submiting=!1,h(e),t.debug(e)})}}function h(e){if(r.error=!0,e)if(e.errors&&e.errors.length>0){var t=e.errors[0];r.errorMessage=t.message}else r.errorMessage="Có lỗi xảy ra, vui lòng thử lại!";else r.errorMessage="Không kết nối được tới máy chủ, vui lòng thử lại!";$("body").css("cursor","normal")}function k(){e.dismiss("cancel")}var _=this;r.addFor=l,_.method=d,_.projec_id=c,_.iUrl=s.API+"?object_type="+r.addFor+"&object_id="+_.projec_id,_.type="1",_.submiting=!1,r.error=!1,r.organizations=p.organization?[p.organization]:[],"edit"==d&&(_.document_number=p.document_number,_.issuer=p.issuer,_.description=p.description,_.type=p.type,_.objectType=p.object_type,_.publish_date=p.publish_date),"show"==d&&(_.document_number=p.document_number,_.issuer=p.issuer,_.description=p.description,_.type=p.type,_.publish_date=p.publish_date,_.organization=p.organization,_.objectType=p.object_type,_.types=[{name:"Công văn đến",value:0},{name:"Công văn đi",value:1}]),_.ok=f,_.cancel=k,_.listFiles=[],r.inlineOptions={customClass:m,minDate:new Date,showWeeks:!0},r.organizationName=function(){var e="Chọn cơ quan";return r.organizations&&r.organizations.length>0?e=r.organizations[0].name:_.issuer&&(e=_.issuer),e},r.dateOptions={dateDisabled:g,showWeeks:!1,formatYear:"yy",startingDay:1},r.openBoxOrganization=function(){n.open({animation:_.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"Danh sách cơ quan"},popupType:function(){return"organization"},canSearch:function(){return!0},multipleSelect:function(){return!1},selectedItems:function(){return console.log(r.organizations),r.organizations},extraData:function(){return null}}})},r.projectNameChanged=function(){r.error=!1},r.toggleMin=function(){r.inlineOptions.minDate=r.inlineOptions.minDate?null:new Date,r.dateOptions.minDate=r.inlineOptions.minDate},r.toggleMin(),r.open1=function(){r.popup1.opened=!0},r.open2=function(){r.popup2.opened=!0},r.setDate=function(e,t,n){r.dt=new Date(e,t,n)},r.popup1={opened:!1},r.popup2={opened:!1},r.changeStartDate=function(){r.changeStartDateStyle="color:inherit;"},r.changeEndDate=function(){r.changeEndDateStyle="color:inherit;"};var v=new Date;v.setDate(v.getDate()+1);var y=new Date;y.setDate(v.getDate()+1),r.events=[{date:v,status:"full"},{date:y,status:"partially"}],r.animationsEnabled=!0}function DocumentController(e,t,n,a,r,o,s,i,c,l,u,d,p){function m(){u.start({message:"Đang tải dữ liệu..."});var t=s.getTasksList(i.METHOD,e.documentUrl,g(),i.HEADERS);t.success(function(t){e.documentList=t.data.documents,n.debug(e.documentList),n.debug(t),e.totalDocs=t.data.total,u.stop()}).error(function(){u.stop()})}function g(){0==e.pageInfoDoc.page?e.offsetVal=0:e.offsetVal=(e.pageInfoDoc.page-1)*e.pageInfoDoc.perPage;var t={offset:e.offsetVal,limit:e.pageInfoDoc.perPage
};return t}switch(e.documentUrl="",e.type){case"task":e.documentUrl=l.API+e.taskId+"/documents";break;case"project":e.documentUrl=c.API+e.projectId+"/documents"}e.pageInfoDoc=r.getNew(2),e.getGetDocuments=m,e.getGetDocuments(),e.offsetVal=0,e.error=!1,e.pageChangedDoc=function(){e.pageInfoDoc.toPageId(e.pageInfoDoc.page),e.getGetDocuments()},e.$on("reload-list-document",function(){e.getGetDocuments()})}function searchController(e,t,n,a,r,o,s,i,c,l,u,d,p){function m(t){var n=d.defer();return setTimeout(function(){e.searchResults=[],n.resolve("true")},200),n.promise}function g(t){if(t!==e.type||e.kw!==e.myKeyword){e.kw=e.myKeyword,e.type=t,e.pages=0;var n=m();n.then(function(){switch(t){case"project":e.currentUrl="/dashboard/project-list",f();break;case"work":e.currentUrl="/dashboard/task-list",h();break;case"person":e.currentUrl="/dashboard/person",k();break;case"document":e.currentUrl="/dashboard/document",_()}})}}function f(){t.debug("get projects00"),y=0==e.pages?0:e.pages*T;var n={offset:y,limit:T,keyword:e.myKeyword},a=o.getTasksList(l.METHOD,l.API,n,l.HEADERS);a.success(function(t){D=t.data.total;for(var n=t.data.projects.length,a=0;a<n;a++)e.searchResults.push({thumbnail:t.data.projects[a].thumbnail?t.data.projects[a].thumbnail:"./assets/img/icons/project_img_icon.png",name:t.data.projects[a].name,link:"#/dashboard/projects/"+t.data.projects[a]._id+"/thongtin",document:!1})}).error(function(e){})}function h(){y=0==e.pages?0:e.pages*T;var t={project:"",user:"",orderby:"",offset:y,limit:T,keyword:e.myKeyword},n=o.getTasksList(i.METHOD,i.API,t,i.HEADERS);n.success(function(t){for(var n=t.data.tasks.length,a=0;a<n;a++)e.searchResults.push({thumbnail:t.data.tasks[a].owner.avatar,name:t.data.tasks[a].title,link:"#/dashboard/tasks/"+t.data.tasks[a]._id,document:!1})}).error(function(e){})}function k(){y=0==e.pages?0:e.pages*T;var t={offset:y,limit:T,keyword:e.myKeyword},n=o.getTasksList(c.METHOD,c.API,t,c.HEADERS);n.success(function(t){for(var n=t.data.users.length,a=0;a<n;a++){var r=[];r.push(t.data.users[a].last_name||""),r.push(t.data.users[a].middle_name||""),r.push(t.data.users[a].first_name||""),e.searchResults.push({thumbnail:t.data.users[a].avatar,name:r.join(" "),id:t.data.users[a]._id,document:!1})}}).error(function(e){})}function _(){y=0==e.pages?0:e.pages*T;var t={offset:y,limit:T,keyword:e.myKeyword},n=o.getTasksList(u.METHOD,u.API,t,u.HEADERS);n.success(function(t){for(var n=t.data.documents.length,a=t.data.documents,r=0;r<n;r++){var o="";switch(a[r].type){case 0:o="in_document.png";break;case 1:o="out_document.png";break;case 2:o="output_document.png"}e.searchResults.push({thumbnail:"assets/img/icons/"+o,name:a[r].document_number,link:"",document:!0,data:a[r]})}}).error(function(e){})}function v(){e.currentUrl=n.path(),e.currentUrl.includes("/dashboard/project-list",0)||e.currentUrl.includes("/dashboard/projects",0)?(e.type="project",e.searchResults=[],f()):(e.type="work",e.searchResults=[],h())}e.type="",e.new_task,e.new_project,e.searchResults=[],e.pages=0,e.loadingMore=!0,e.displayName=s.getUserName(),e.userAvatar=s.getUserAvatar();var y,D=0,T=10;e.message={};var b=s.getData();e.resetData=s.removeData(),"new-task"===b.key&&(e.new_task=b.value,e.createTask=!0,e.message={type:"success",content:'Tác vụ <a class="cursor-pointer" ng-href="#/dashboard/tasks/'+e.new_task._id+'"><strong>'+e.new_task.title+"</strong></a> đã được tạo thành công!"}),e.search_result=!1,g(e.type),e.changeSection=g,e.myKeyword="",e.kw="",e.$watch("myKeyword",function(t,n){t!==n&&g(e.type)}),e.loadMore=function(){switch(e.loadingMore=!1,e.pages++,e.type){case"project":f();break;case"work":h();break;case"person":k();break;case"document":_()}},e.pressSearch=function(){e.display=$(".search-results").css("display"),"none"===e.display&&v(),e.mystyle={display:"block"}}}function projectCreateController(e,t,n,a,r,o,s,i,c,l){function u(){return{name:e.name||"",owner:r.getUserId(),description:e.description||"",location:e.location||"",scale:e.scale||"",total_investment:e.total_investment||"",investor_unit:e.investor_unit||"",manager_unit:e.manager_unit||"",plan_start_date:e.plan_start_date?e.plan_start_date.yyyymmdd():"",plan_end_date:e.plan_end_date?e.plan_end_date.yyyymmdd():"",members:e.selected_member||[],viewers:e.selected_viewer||[],task_templates:e.list_main_tasks||null}}function d(){var o=e.params();if("undefined"!=typeof e.plan_start_date&&"undefined"!=typeof e.plan_end_date){var c=e.plan_start_date.getTime(),u=e.plan_end_date.getTime();if(c>u)return void s.$broadcast("event-error","Ngày kết thúc phải lớn hơn ngày bắt đầu")}if(""!==o.scale&&!isNumeric(o.scale))return void s.$broadcast("event-error","Diện tích phải nhập số hoặc để trống");if(""!==o.total_investment&&!isNumeric(o.total_investment))return void s.$broadcast("event-error","Số tiền phải nhập số hoặc để trống");t.debug("data project: "),t.debug(o),l.start("Đang xử lý ..."),e.processing=!0;var d=n.postMethod(a.METHOD,a.API,o,a.HEADERS);d.success(function(t){if(e.processing=!1,"undefined"!=typeof e.photo){var o=a.API+t.data._id+"/thumbnail",s={"Content-Type":void 0},c=new FormData;c.append("photo",e.photo);var u=n.uploadMethod(a.METHOD,o,c,s);u.success(function(e){l.stop(),r.setData("new-project",t.data),i.go("dashboard.project-list")}).error(function(e){l.stop()})}else{e.processing=!1,l.stop(),r.setData("new-project",t.data);r.getData();i.go("dashboard.project-list")}}).error(function(t){if(l.stop(),e.error=!0,e.processing=!1,t.errors&&t.errors.length>0){var n=t.errors[0];e.mgs_error=n.message}else e.mgs_error="Có lỗi xảy ra, vui lòng thử lại!"})}function p(){$("input[fileread]").trigger("click")}function m(e){}function g(t){c.open({animation:e.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/box-select-main-task.html",controller:"BoxMainTasksCtrl",controllerAs:"$ctrl",resolve:{items:function(){return e.selected_tasks},viewer:function(){return e.selected_viewer},member:function(){return e.selected_member},type:function(){return t},title:function(){return"Chọn tác vụ chính"},mainTasks:function(){return e.selected_tasks}}})}function f(t){var n=t.date,a=t.mode;if("day"===a)for(var r=new Date(n).setHours(0,0,0,0),o=0;o<e.events.length;o++){var s=new Date(e.events[o].date).setHours(0,0,0,0);if(r===s)return e.events[o].status}return""}function h(){$(".project-create-choose-img").trigger("click")}e.params=u,e.doAdd=d,e.doCancel=r.removeData(),e.eventClickChooseFile=p,e.clickOnChooseImg=h,e.processing=!1,e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd/MM/yyyy","shortDate"],e.format=e.formats[2],e.altInputFormats=["M!/d!/yyyy"],e.error=!1,e.selected_viewer=[],e.selected_tasks=null,e.list_main_tasks=null,e.selected_member=[],e.task_templates=[],e.openMainTask=g,e.$on("event-upload",function(t,n){e.photo=n}),e.$on("event-error",function(t,n){e.error=!0,e.mgs_error=n}),e.$on("select-task",function(t,n){e.selected_tasks=n}),e.$on("select-user",function(t,n){e.selected_member=n}),e.$on("list-main-task",function(t,n){e.list_main_tasks=n}),e.dbClick=function(){e.processing=!0},e.hideAlert=function(){$("button.close").parent().hide()},e.inlineOptions={customClass:f,minDate:new Date,showWeeks:!0},e.dateOptions={dateDisabled:m,showWeeks:!1,formatYear:"yy",startingDay:1},e.toggleMin=function(){e.inlineOptions.minDate=e.inlineOptions.minDate?null:new Date,e.dateOptions.minDate=e.inlineOptions.minDate},e.toggleMin(),e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},e.setDate=function(t,n,a){e.dt=new Date(t,n,a)},e.popup1={opened:!1},e.popup2={opened:!1},e.changeStartDate=function(){e.changeStartDateStyle="color:inherit;"},e.changeEndDate=function(){e.changeEndDateStyle="color:inherit;"},e.changeProjectName=function(){e.error=!1,e.mgs_error=""};var k=new Date;k.setDate(k.getDate()+1);var _=new Date;_.setDate(k.getDate()+1),e.events=[{date:k,status:"full"},{date:_,status:"partially"}],e.animationsEnabled=!0,e.openMemberBox=function(t){c.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"member"===t?"Chọn thành viên":"Chọn người giám sát"},popupType:function(){return t},canSearch:function(){return!0},multipleSelect:function(){return!0},selectedItems:function(){return"member"===t?e.selected_member:e.selected_viewer},extraData:function(){return{projectId:e.idProject}}}})}}function projectEditController(e,t,n,a,r,o,s,i,c,l,u,d,p,m,g,f){function h(t){var n=a.API+e.projectId+"/"+t,r={limit:"members"===t?e.project.total_member:e.project.total_viewer},o=f.getTasksList(a.METHOD,n,r,a.HEADERS);o.success(function(n){"members"===t?n.data.users&&$.each(n.data.users,function(t,n){e.selected_member.push(n._id)}):n.data.users&&$.each(n.data.users,function(t,n){e.selected_viewer.push(n._id)})})}function k(){var t={name:e.project.name||"",owner:s.getUserId()||"",description:e.project.description||"",location:e.project.location||"",scale:e.project.scale||"",total_investment:e.project.total_investment||"",investor_unit:e.project.investor_unit||"",manager_unit:e.project.manager_unit||"",members:e.selected_member||[],plan_start_date:"",plan_end_date:""};return"object"==typeof e.project.plan_start_date&&(t.plan_start_date=e.project.plan_start_date.yyyymmdd()),"object"==typeof e.project.plan_end_date&&(t.plan_end_date=e.project.plan_end_date.yyyymmdd()),t}function _(){var t=k();if("object"==typeof e.project.plan_start_date&&"object"==typeof e.project.plan_end_date){var a=e.project.plan_start_date.getTime(),s=e.project.plan_end_date.getTime();if(a>s)return void c.$broadcast("event-error","Ngày kết thúc phải lớn hơn ngày bắt đầu")}if(""!==t.scale&&!isNumeric(t.scale))return void c.$broadcast("event-error","Diện tích phải nhập số hoặc để trống");if(""!==t.total_investment&&!isNumeric(t.total_investment))return void c.$broadcast("event-error","Số tiền phải nhập số hoặc để trống");var i=n.postMethod(r.METHOD,S,t,r.HEADERS);i.success(function(t){$("#link-back").attr("href");if("undefined"!=typeof e.photo){var a=o.API+t.data._id+"/thumbnail",r={"Content-Type":void 0},s=new FormData;s.append("photo",e.photo);var i=n.uploadMethod(o.METHOD,a,s,r);i.success(function(t){l.go("dashboard.project-infomation",{idProject:e.projectId})})}else l.go("dashboard.project-infomation",{idProject:e.projectId})}).error(function(t){if(t.errors&&t.errors.length>0){var n=t.errors[0];e.mgs_error=n.message}else t.data?("total_investment.total"===t.data.parameters[0]&&(e.mgs_error="Số tiền phải nhập số hoặc để trống"),"scale.total"===t.data.parameters[0]&&(e.mgs_error="Diện tích phải nhập số hoặc để trống")):e.mgs_error="Có lỗi xảy ra, vui lòng thử lại!";e.error=!0})}function v(){g.start({message:"Đang xử lý ..."});var t=u.getMethod(a.METHOD,S,a.HEADERS);console.log(e.selected_member),t.success(function(t){g.stop(),e.project=t.data,e.project.plan_start_date=e.project.plan_start_date?new Date(e.project.plan_start_date):"",e.project.plan_end_date=e.project.plan_end_date?new Date(e.project.plan_end_date):"",e.project.owner=e.project.owner._id,e.project.total_investment=e.project.total_investment?e.project.total_investment.total:"",e.project.scale=e.project.scale?e.project.scale.total:"",e.project.thumbnail=p("photo")(e.project.thumbnail),e.baseData=angular.copy(e.project),e.project.total_member&&h("members"),e.baseData={name:e.baseData.name,owner:s.getUserId(),description:e.baseData.description||"",location:e.baseData.location||"",scale:e.baseData.scale||"",total_investment:e.baseData.total_investment||"",investor_unit:e.baseData.investor_unit||"",manager_unit:e.baseData.manager_unit||"",members:e.selected_member||[],plan_start_date:e.baseData.plan_start_date,plan_end_date:e.baseData.plan_end_date},b(e.baseData)}).error(function(e){g.stop()})}function y(t){var n=t.date,a=t.mode;if("day"===a)for(var r=new Date(n).setHours(0,0,0,0),o=0;o<e.events.length;o++){var s=new Date(e.events[o].date).setHours(0,0,0,0);if(r===s)return e.events[o].status}return""}function D(){$("input[fileread]").trigger("click")}function T(t){m.open({animation:e.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/box-select-main-task.html",controller:"BoxMainTasksCtrl",controllerAs:"$ctrl",resolve:{items:function(){return e.selected_tasks},viewer:function(){return e.selected_viewer},member:function(){return e.selected_member},type:function(){return t},title:function(){return"Chọn tác vụ chính"},mainTasks:function(){return e.list_main_tasks}}})}function b(t){e.master_data=angular.copy(t)}e.projectId=d.idProject;var S=a.API+e.projectId;e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd/MM/yyyy","shortDate"],e.format=e.formats[2],e.error=!1,e.eventClickChooseFile=D,e.total_member=0,e.total_viewer=0,e.doEdit=_,e.selected_viewer=[],e.selected_member=[],e.selected_tasks=[],e.list_main_tasks=[],e.task_templates=[],e.openMainTask=T,e.$on("select-user",function(t,n){e.selected_member=n}),v(),e.changeProjectName=function(){e.error=!1,e.mgs_error=""},e.inlineOptions={customClass:y,minDate:new Date,showWeeks:!0},e.dateOptions={showWeeks:!1,formatYear:"yy",startingDay:1},e.popup1={opened:!1},e.popup2={opened:!1},e.$on("event-upload",function(t,n){e.photo=n}),e.$on("event-error",function(t,n){e.error=!0,e.mgs_error=n}),e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},e.openMemberBox=function(t){m.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"member"===t?"Chọn thành viên":"Chọn người giám sát"},popupType:function(){return t},canSearch:function(){return!0},multipleSelect:function(){return!0},selectedItems:function(){return"member"===t?e.selected_member:e.selected_viewer},extraData:function(){return{projectId:e.idProject}}}})}}function projectInfoController(e,t,n,a,r,o,s,i,c,l,u){e.openBox=function(t,a){n.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/box-task-list-project.html",controller:"ModalTasksCtrl",controllerAs:"$ctrl",resolve:{projectId:function(){return a},selectedMember:function(){return"supervisor"===t?e.selectedSupervisor:e.selectedAssignee},type:function(){return t},taskId:function(){return e.taskId}}})}}function ModalTasksCtrl(e,t,n,a,r,o,s,i,c,l,u,d,p,m){function g(){u.start("Đang xử lý ..."),_.tasksProjectUrl=d.API+s+"/tasks",n.debug(_.getParam());var e=m.getTasksList(d.METHOD,_.tasksProjectUrl,_.getParam(),d.HEADERS);e.success(function(e){u.stop(),_.tasksProject=e.data.tasks}).error(function(e){u.stop(),n.debug("error")})}function f(){var e={status:c,offset:0};return e}function h(){a.dismiss("cancel")}function k(){a.dismiss("cancel")}var _=this;_.getParam=f,_.getTasksProject=g,_.getTasksProject(),_.idProject=s,_.membersProject=[],_.type=c,_.statusPopup,_.ok=h,_.completeSuper=k,6==_.type?_.modalTitle="Tác vụ đang trễ":2==_.type?_.modalTitle="Tác vụ đã hoàn thành":0==_.type&&(_.modalTitle="Tác vụ mới"),n.debug(_.idProject);t.$on("hiden-popup",function(e,t){_.statusPopup=t}),_.statusPopup&&a.dismiss("cancel"),console.log("status popup : "+_.statusPopup)}function taskCreateController(e,t,n,a,r,o,s,i,c,l,u,d,p,m,g,f,h){function k(e){}function _(e){var n=e.date,a=e.mode;if("day"===a)for(var r=new Date(n).setHours(0,0,0,0),o=0;o<t.events.length;o++){var s=new Date(t.events[o].date).setHours(0,0,0,0);if(r===s)return t.events[o].status}return""}function v(e){var t=null;return e&&(t=e.last_name?e.last_name:"",e.middle_name&&(t=t+" "+e.middle_name),e.first_name&&(t=t+" "+e.first_name)),t}if(t.myVal="hello",t.title_page="Tạo Tác Vụ",t.idProject=r.idProject,t.membersProject,t.selectedMember="",t.selectAssignee={},t.selectAssigner={},t.selectedSupervisors=[],t.selectedAssignees=[],t.selectedAssigners=[],t.labelSupervisor="Người giám sát",t.labelAssignee="Người thực hiện",t.labelAssigner="Người giao việc",t.namePriority="Độ ưu tiên",t.iconPriority="./assets/img/icons/tre_cin.png",t.idPriority=0,t.numberFile=0,t.listDocuments=[],t.selected_org=[],t.selectedDependencyTasks=[],t.isCreatSubTask=!1,t.processing=!1,t.inlineOptions={customClass:_,minDate:new Date,showWeeks:!0},r.idTask){t.isCreatSubTask=!0,t.idTask=r.idTask,t.title_page="Tạo Tác Vụ Con";var y=f.API+t.idTask,D=m.getMethod(f.METHOD,y,f.HEADERS);D.success(function(e){t.taskDetail=e.data})}t.dateOptions={dateDisabled:k,showWeeks:!1,formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1},t.assigneeName=function(){var e="Người thực hiện";if(t.selectedAssignees&&t.selectedAssignees.length>0){var n=t.selectedAssignees[0];e=v(n)}return e},t.assignerName=function(){var e="Người giao việc";if(t.selectedAssigners&&t.selectedAssigners.length>0){var n=t.selectedAssigners[0];e=v(n)}return e},t.priorities=[{name:"Thấp",urlIcon:"./assets/img/icons/tre_cin.png",id:0},{name:"Bình Thường",urlIcon:"./assets/img/icons/binhthuong_icn.png",id:1},{name:"Cao",urlIcon:"./assets/img/icons/cao_icn.png",id:2},{name:"Khẩn Cấp",urlIcon:"./assets/img/icons/khancap_icn.png",id:3}],t.$on("event-error",function(e,n){t.error=!0,t.mgs_error=n}),t.prioritySelected=function(e){t.namePriority=e.name,t.iconPriority=e.urlIcon,t.idPriority=e.id},t.openMemberBox=function(e){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"supervisor"===e?"Chọn người giám sát":"assigner"===e?"Chọn người giao việc":"Chọn người thực hiện"},popupType:function(){return e},canSearch:function(){return!0},multipleSelect:function(){return"supervisor"===e},selectedItems:function(){return"supervisor"===e?t.selectedSupervisors:"assigner"===e?t.selectedAssigners:t.selectedAssignees},extraData:function(){return{projectId:t.idProject}}}})},t.openBoxOrganization=function(){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"Danh sách cơ quan"},popupType:function(){return"organization"},canSearch:function(){return!0},multipleSelect:function(){return!0},selectedItems:function(){return t.selected_org},extraData:function(){return null}}})},t.openBoxTaskDependency=function(){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"Công việc phụ thuộc"},popupType:function(){return"task-dependency"},canSearch:function(){return!1},multipleSelect:function(){return!0},selectedItems:function(){return t.selectedDependencyTasks},extraData:function(){return{projectId:t.idProject,taskId:null,parentId:t.idTask}}}})},t.addDocument=function(e){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/add-document.html",controller:"ModalAddDocumentCtrl",controllerAs:"$ctrl",scope:t,size:e,resolve:{items:function(){return t.idProject},documentFor:function(){return 1},documents:function(){return t.listDocuments},method:function(){return""},data:function(){return{}}}})},t.createNewTask=function(){var n=null,a=null;if(t.selectedAssignees&&t.selectedAssignees.length>0&&(n=t.selectedAssignees[0]._id),t.selectedAssigners&&t.selectedAssigners.length>0&&(a=t.selectedAssigners[0]._id),t.start_date=convertDate(new Date(t.plan_start_date)),t.end_date=convertDate(new Date(t.plan_end_date)),!t.title)return void e.$broadcast("event-error","Tên công việc không được để trống!");if(!t.plan_start_date&&!t.plan_end_date)return void e.$broadcast("event-error","Ngày bắt đầu và ngày kết thúc không được để trống!");if(!t.plan_start_date)return void e.$broadcast("event-error","Ngày bắt đầu không được để trống!");if(!t.plan_end_date)return void e.$broadcast("event-error","Ngày kết thúc không được để trống!");var s=t.plan_start_date.getTime(),i=t.plan_end_date.getTime();if(s>i)return void e.$broadcast("event-error","Ngày kết thúc phải lớn hơn ngày bắt đầu!");var l={title:t.title,project:t.idProject,supervisors:t.selectedSupervisors,dependencies:t.selectedDependencyTasks?t.selectedDependencyTasks:[],description:t.description,priority:t.idPriority,parent:t.idTask?t.idTask:"",owner:g.getUserId(),assignee:n,assigner:a,organizations:t.selected_org,plan_start_date:t.start_date,plan_end_date:t.end_date};if(t.processing)return!1;h.start("Đang xử lý ...");var d=c.postMethod(u.METHOD,u.API,l,u.HEADERS);d.success(function(e){t.processing=!0,g.setData("new-task",e.data),r.idTask?o.go("dashboard.task-detail",{idTask:t.idTask}):o.go("dashboard.project-infomation",{idProject:t.idProject,nameTab:"tacvu"}),h.stop()}).error(function(e){t.processing=!1,h.stop()})},t.toggleMin=function(){t.inlineOptions.minDate=t.inlineOptions.minDate?null:new Date,t.dateOptions.minDate=t.inlineOptions.minDate},t.toggleMin(),t.open1=function(){t.popup1.opened=!0},t.open2=function(){t.popup2.opened=!0},t.setDate=function(e,n,a){t.dt=new Date(e,n,a)},t.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd/MM/yyyy","shortDate"],t.format=t.formats[2],t.altInputFormats=["M!/d!/yyyy"],t.popup1={opened:!1},t.popup2={opened:!1},t.changeStartDate=function(){t.changeStartDateStyle="color:inherit;"},t.changeEndDate=function(){t.changeEndDateStyle="color:inherit;"}}function taskEditController(e,t,n,a,r,o,s,i,c,l,u,d,p,m,g,f,h){function k(){return{}}function _(e){var a=h.API+"tasks/"+e+"/dependencies",r=c.getTasksList(h.METHOD,a,k(),h.HEADERS);r.success(function(e){t.dependencies_task=e.data.tasks,t.dependencies_task&&$.each(t.dependencies_task,function(e,n){t.selectedDependencyTasks.push(n._id)})}).error(function(e){n.debug("response")})}function v(){g.start("Đang xử lý ...");var e=p.getMethod(f.METHOD,t.taskUrl,f.HEADERS);e.success(function(e){switch(t.isChangedMasterData=E,t.task=e.data,t.orginData=e.data,t.idProject=t.task.project._id,n.debug(t.task.dependency_num),t.dependency_num=t.task.dependency_num,t.taskId=t.task._id,t.dependency_num&&_(t.taskId),t.orginData.organizations&&t.orginData.organizations.forEach(function(e){t.selected_org.push(e._id)}),t.baseData=angular.copy(t.task),t.baseData={title:t.baseData.title,project:t.baseData.project._id,owner:t.baseData.owner._id,supervisor:t.baseData.supervisor?t.baseData.supervisor._id:"",dependencies:t.selectedDependencyTasks,description:t.baseData.description,priority:t.baseData.priority,organizations:t.baseData.organizations,parent:t.idTask?t.idTask:"",plan_start_date:new Date(t.baseData.plan_start_date),plan_end_date:new Date(t.baseData.plan_end_date)},t.id_assigner=t.task.assigner?t.task.assigner._id:"",t.id_supervisor=t.task.supervisor?t.task.supervisor._id:"",t.task.plan_start_date=t.task.plan_start_date?new Date(t.task.plan_start_date):"",t.task.plan_end_date=t.task.plan_end_date?new Date(t.task.plan_end_date):"",t.task={title:t.task.title,project:t.task.project._id,owner:t.task.owner._id,supervisor:t.task.supervisor?t.task.supervisor._id:"",dependencies:t.selectedDependencyTasks,description:t.task.description,priority:t.task.priority,parent:t.idTask?t.idTask:"",plan_start_date:new Date(t.task.plan_start_date),plan_end_date:new Date(t.task.plan_end_date)},S(t.baseData),e.data.owner&&(t.selectedAssignees=[e.data.owner]),e.data.assigner&&(t.selectedAssigners=[e.data.assigner]),t.id_assigner=e.data.owner?e.data.owner._id:"",e.data.supervisors&&e.data.supervisors.forEach(function(e){t.selectedSupervisors.push(e._id)}),t.id_supervisor=e.data.supervisor?e.data.supervisor._id:"",t.task.plan_start_date=e.data.plan_start_date?new Date(e.data.plan_start_date):"",t.task.plan_end_date=e.data.plan_end_date?new Date(e.data.plan_end_date):"",t.idProject=e.data.project._id,t.task.priority){case 0:t.iconPriority="./assets/img/icons/tre_cin.png",t.namePriority="Trễ";break;case 1:t.iconPriority="./assets/img/icons/binhthuong_icn.png",t.namePriority="Bình Thường";break;case 2:t.iconPriority="./assets/img/icons/cao_icn.png",t.namePriority="Cao";break;case 3:t.iconPriority="./assets/img/icons/khancap_icn.png",t.namePriority="Khẩn Cấp";break;default:t.iconPriority="./assets/img/icons/tre_cin.png",t.namePriority="Độ Ưu Tiên"}t.name_task,g.stop()}).error(function(e){g.stop()})}function y(e){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"modalConfirmChange.html",controller:"BoxResonChange",controllerAs:"$ctrl",resolve:{projectId:function(){return t.idProject},selectedMember:function(){return t.selectedMember},type:function(){return"supervisor"},data:function(){return e},idTask:function(){return r.idTask},listDocuments:function(){return t.listDocuments}}})}function D(){var e=null;t.selectedAssignees&&t.selectedAssignees.length>0&&(e=t.selectedAssignees[0]._id);var a=null;t.selectedAssigners&&t.selectedAssigners.length>0&&(a=t.selectedAssigners[0]._id);var r={title:t.task.title||"",project:t.idProject,supervisors:t.selectedSupervisors,dependencies:t.selectedDependencyTasks,description:t.task.description,priority:t.idPriority,parent:t.idTask?t.idTask:"",plan_start_date:t.task.plan_start_date,plan_end_date:t.task.plan_end_date,owner:e,assigner:a,organizations:t.selected_org};return n.debug("iData Edit Task: "),n.debug(r),r}function T(e){}function b(e){var n=e.date,a=e.mode;if("day"===a)for(var r=new Date(n).setHours(0,0,0,0),o=0;o<t.events.length;o++){var s=new Date(t.events[o].date).setHours(0,0,0,0);if(r===s)return t.events[o].status}return""}function S(e){t.master_data=angular.copy(e)}function E(){return!t.task.title||angular.equals(t.task,t.master_data)}if(t.myVal="hello",t.title_page="Tạo Tác Vụ",t.idProject=r.idProject,t.membersProject,t.selectedMember="",t.selectAssignee="",t.selectAssigner="",t.selectedSupervisors=[],t.selectedAssignees=[],t.selectedAssigners=[],t.name_supervisor="Chọn người giám sát",t.name_assigner="Chọn người thực hiện",t.namePriority="Độ ưu tiên",t.iconPriority="./assets/img/icons/tre_cin.png",t.idPriority=0,t.numberFile=0,t.listDocuments=[],t.selected_org=[],t.selectedDependencyTasks=[],t.isCreatSubTask=!1,t.comments="",t.taskId="",t.status=!1,t.taskUrl=f.API+r.idTask,v(),t.inlineOptions={customClass:b,minDate:new Date,showWeeks:!0},r.idTask){t.isCreatSubTask=!0,t.idTask=r.idTask,t.title_page="Tạo Tác Vụ Con";var w=f.API+t.idTask,I=p.getMethod(f.METHOD,w,f.HEADERS);I.success(function(e){t.taskDetail=e.data})}t.dateOptions={dateDisabled:T,showWeeks:!1,formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1},t.priorities=[{name:"Thấp",urlIcon:"./assets/img/icons/tre_cin.png",id:0},{name:"Bình Thường",urlIcon:"./assets/img/icons/binhthuong_icn.png",id:1},{name:"Cao",urlIcon:"./assets/img/icons/cao_icn.png",id:2},{name:"Khẩn Cấp",urlIcon:"./assets/img/icons/khancap_icn.png",id:3}],t.$on("event-error",function(e,n){t.error=!0,t.mgs_error=n}),t.assigneeName=function(){var e="Người thực hiện";if(t.selectedAssignees&&t.selectedAssignees.length>0){var n=t.selectedAssignees[0];e=n.last_name?n.last_name:"",n.middle_name&&(e=e+" "+n.middle_name),n.first_name&&(e=e+" "+n.first_name)}return e},t.assignerName=function(){var e="Người giao việc";if(t.selectedAssigners&&t.selectedAssigners.length>0){var n=t.selectedAssigners[0];e=n.last_name?n.last_name:"",n.middle_name&&(e=e+" "+n.middle_name),n.first_name&&(e=e+" "+n.first_name)}return e},t.openBoxOrganization=function(){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"Danh sách cơ quan"},popupType:function(){return"organization"},canSearch:function(){return!0},multipleSelect:function(){return!0},selectedItems:function(){return t.selected_org},extraData:function(){return null}}})},t.openBoxTaskDependency=function(){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"Công việc phụ thuộc"},popupType:function(){return"task-dependency"},canSearch:function(){return!1},multipleSelect:function(){return!0},selectedItems:function(){return t.selectedDependencyTasks},extraData:function(){return{projectId:t.idProject,taskId:t.taskId,parentId:t.taskDetail.parent}}}})},t.openMemberBox=function(e){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/items-popup.html",controller:"ItemsPopupCtroller",resolve:{title:function(){return"supervisor"===e?"Người giám sát":"assigner"===e?"Chọn người giao việc":"Người thực hiện"},popupType:function(){return e},canSearch:function(){return!0},multipleSelect:function(){return"supervisor"===e},selectedItems:function(){return"supervisor"===e?t.selectedSupervisors:"assigner"===e?t.selectedAssigners:t.selectedAssignees},extraData:function(){return{projectId:t.idProject}}}})},t.prioritySelected=function(e){t.namePriority=e.name,t.iconPriority=e.urlIcon,t.idPriority=e.id,t.task.priority=e.id},t.addDocument=function(e){a.open({animation:$ctrl.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/add-document.html",controller:"ModalAddDocumentCtrl",controllerAs:"$ctrl",scope:t,size:e,resolve:{items:function(){return t.idProject},documentFor:function(){return 1},documents:function(){return t.listDocuments},idTask:function(){return""},listDocuments:function(){return t.listDocuments},method:function(){return""},data:function(){return{}}}})},t.$on("get-comments",function(e,n){t.comments=n}),t.$on("list-file",function(e,n){t.listDocuments.push(n),t.numberFile+=t.listDocuments.length}),t.editTask=function(){if(!t.task.title)return void e.$broadcast("event-error","Tên công việc không được để trống!");if(!t.task.plan_start_date&&!t.task.plan_end_date)return void e.$broadcast("event-error","Ngày bắt đầu và ngày kết thúc không được để trống!");if(!t.task.plan_start_date)return void e.$broadcast("event-error","Ngày bắt đầu không được để trống!");if(!t.task.plan_end_date)return void e.$broadcast("event-error","Ngày kết thúc không được để trống!");var a=t.task.plan_start_date.getTime(),r=t.task.plan_end_date.getTime();if(a>r)return void e.$broadcast("event-error","Ngày kết thúc phải lớn hơn ngày bắt đầu!");var s=D(),c=l.API+t.taskId;if(angular.equals(t.task.plan_end_date,t.baseData.plan_end_date)){s.plan_end_date=null;var u=i.postMethod(l.METHOD,c,s,l.HEADERS);u.success(function(e){for(var a=1,r=d.API+"?object_type="+a+"&object_id="+t.taskId,s=0;s<t.listDocuments.length;s++){var c={issuer:t.listDocuments[s].issuer,description:t.listDocuments[s].description,document_number:t.listDocuments[s].document_number,type:t.listDocuments[s].type},l=i.postMethod(d.METHOD,r,c,d.HEADERS);l.success(function(e){}).error(function(e){n.debug(e)})}o.go("dashboard.task-detail",{idTask:t.taskId})}).error(function(e){n.debug(e)})}else y(s)},t.toggleMin=function(){t.inlineOptions.minDate=t.inlineOptions.minDate?null:new Date,t.dateOptions.minDate=t.inlineOptions.minDate},t.toggleMin(),t.open1=function(){t.popup1.opened=!0},t.open2=function(){t.popup2.opened=!0},t.setDate=function(e,n,a){t.dt=new Date(e,n,a)},t.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd/MM/yyyy","shortDate"],t.format=t.formats[2],t.altInputFormats=["M!/d!/yyyy"],t.popup1={opened:!1},t.popup2={opened:!1},t.changeStartDate=function(){t.changeStartDateStyle="color:inherit;"},t.changeEndDate=function(){t.changeEndDateStyle="color:inherit;"}}function BoxResonChange(e,t,n,a,r,o,s,i,c,l,u,d,p,m,g,f){function h(){if(_.editer_comments){_.iData.comment=_.editer_comments,a.debug("$ctrl.iData: "),a.debug(_.iData);
var e=o.postMethod(i.METHOD,_.taskUrl,_.iData,i.HEADERS);e.success(function(e){for(var n=1,r=s.API+"?object_type="+n+"&object_id="+p,i=0;i<_.listDocuments.length;i++){var c={issuer:_.listDocuments[i].issuer,description:_.listDocuments[i].description,document_number:_.listDocuments[i].document_number,type:_.listDocuments[i].type},l=o.postMethod(s.METHOD,r,c,s.HEADERS);l.success(function(e){}).error(function(e){a.debug(e)})}t.go("dashboard.task-detail",{idTask:p})}).error(function(e){a.debug(e)})}else n.$broadcast("event-error","Vui lòng nhập lý do thay đổi!");r.dismiss("cancel")}function k(){r.dismiss("cancel")}var _=this;_.type=u,_.iData=d,_.taskUrl=i.API+p,_.listDocuments=m,_.ok=k,_.sendComments=h}function exportReportController($scope,getTasksListService,EXPORT_REPORT,blockUI){function getWeekNumber(e){var e=new Date(+e);e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1),n=Math.ceil(((e-t)/864e5+1)/7);return[e.getFullYear(),n]}function getStartDateOfWeek(e,t){var n=new Date(t,0,1+7*(e-1)),a=n.getDay(),r=n;return a<=4?r.setDate(n.getDate()-n.getDay()+1):r.setDate(n.getDate()+8-n.getDay()),r}function getEndDateOfWeek(e,t){var n=getStartDateOfWeek(e,t);return n.setDate(n.getDate()+6)}function getDateRangeOfWeek(weekNo,year,firstOrLastDate){var startDate=getStartDateOfWeek(weekNo,year),rangeIsFrom=startDate.getDate()+"/"+eval(startDate.getMonth()+1)+"/"+startDate.getFullYear();startDate.setDate(startDate.getDate()+6);var rangeIsTo=startDate.getDate()+"/"+eval(startDate.getMonth()+1)+"/"+startDate.getFullYear();return"last"==firstOrLastDate?rangeIsTo:rangeIsFrom}function weeksInYear(e){var t=new Date(e,11,31),n=getWeekNumber(t)[1];return 1==n?getWeekNumber(t.setDate(24))[1]:n}function fnSetWeekSelected(){var e=$scope.objWeekSelected.weekNumber,t=$scope.objWeekSelected.fromDate,n=$scope.objWeekSelected.toDate;$(".p-number-week").html("Tuần "+e),$(".p-fromto-week").html("Từ "+t+" đến "+n)}function fnSetYearSelected(){var e=$scope.objYearSelected.yearNumber;$(".p-year").html(e)}var totalPages=0,totalHistory=0,limit=20,offsetVal;$scope.objWeekSelected={},$scope.objYearSelected={},$scope.weeksExportReportResults=[],$scope.historiesExportReportResults=[],$scope.yearsExportReportResults=[],$scope.pagesHistory=0,$scope.canLoadMoreHistory=!0,$scope.checkAgainFileStatus=!0,$scope.error=!1,Date.prototype.getWeek=function(){var e=new Date(this.valueOf()),t=(this.getDay()+6)%7;e.setDate(e.getDate()-t+3);var n=new Date(e.getFullYear(),0,4),a=(e-n)/864e5;return new Date(e.getFullYear(),0,1).getDay()<5?1+Math.ceil(a/7):Math.ceil(a/7)},$scope.getListOfAllWeeksOfYear=function(e){$scope.weeksExportReportResults.length>0&&($scope.weeksExportReportResults=[]),$(".select-week-dropdown li ul week-for-export-report").children().remove();var t=new Date,n=t.getFullYear(),a=t.getWeek();"undefined"!=typeof e&&e!=n?(a=weeksInYear(e),n=e):$scope.objYearSelected.yearNumber=n;for(var r=a;r>=1;r--){var o={};o.weekNumber=r.toString(),o.fromDate=getDateRangeOfWeek(r,n,"first"),o.toDate=getDateRangeOfWeek(r,n,"last"),$scope.weeksExportReportResults.push(o)}$scope.objWeekSelected=$scope.weeksExportReportResults[0],fnSetWeekSelected()},$scope.getListOfYearsFromNow=function(){for(var e=(new Date).getFullYear(),t=e;t>=e-10;t--){var n={};n.yearNumber=t.toString(),$scope.yearsExportReportResults.push(n)}},$scope.showAlertError=function(e){if($scope.error=!0,$("#alert-export-report").show(),null!=e&&e.errors&&e.errors.length>0){var t=e.errors[0];$scope.mgs_error=t.message}else $scope.mgs_error="Có lỗi xảy ra, vui lòng thử lại!";setTimeout(function(){$("#alert-export-report").hide(),$scope.error=!1,$scope.mgs_error=""},2e3)},$scope.exportReport=function(){blockUI.start({message:"Đang xử lý ..."});var e={week:$scope.objWeekSelected.weekNumber,year:$scope.objYearSelected.yearNumber},t=EXPORT_REPORT.API+"project",n=getTasksListService.getTasksList(EXPORT_REPORT.METHOD,t,e,EXPORT_REPORT.HEADERS);n.success(function(e){null!=e.data._id?($scope.checkAgainFileStatus=!0,$scope.checkStatusOfReport($scope.objWeekSelected.weekNumber,2016,e.data._id)):blockUI.stop()}).error(function(e){blockUI.stop(),$scope.showAlertError(e)})},$scope.checkStatusOfReport=function(e,t,n){var a={week:e,year:t},r=EXPORT_REPORT.API+"file/"+n+"/status",o=getTasksListService.getTasksList(EXPORT_REPORT.METHOD,r,a,EXPORT_REPORT.HEADERS);o.success(function(a){null!=a.data.status?0==a.data.status?1==$scope.checkAgainFileStatus&&setTimeout(function(){$scope.checkStatusOfReport(e,t,n)},1e3):(blockUI.stop(),$scope.checkAgainFileStatus=!1,1==a.data.status&&($scope.pagesHistoy=0,$scope.getHistoryReport(!0),window.location.href=a.data.link)):(blockUI.stop(),$scope.checkAgainFileStatus=!1)}).error(function(e){blockUI.stop(),$scope.checkAgainFileStatus=!1,$scope.showAlertError(e)})},$scope.getHistoryReport=function(e){"undefined"!=e&&e&&($scope.historiesExportReportResults=[]),blockUI.start({message:"Đang xử lý ..."}),offsetVal=0==$scope.pagesHistoy?0:$scope.pagesHistoy*limit;var t={offset:offsetVal,limit:limit},n=getTasksListService.getTasksList(EXPORT_REPORT.METHOD,EXPORT_REPORT.API,t,EXPORT_REPORT.HEADERS);n.success(function(e){$scope.canLoadMoreHistory=!0,totalHistory=e.data.total;var t=[];if(null!=e.data.historys&&(t=e.data.historys),t.length>0)for(var n=0;n<t.length;n++){var a=t[n],r={};r.weekNumber=a.week,r.fromDate=getDateRangeOfWeek(a.week,a.year,"first"),r.toDate=getDateRangeOfWeek(a.week,a.year,"last"),r.timeAgo=a.updated_at,r.link=a.link,$scope.historiesExportReportResults.push(r)}blockUI.stop()}).error(function(e){blockUI.stop(),$scope.canLoadMoreHistory=!0,$scope.showAlertError(e)})},$scope.$on("$viewContentLoaded",function(){$scope.getListOfAllWeeksOfYear(),$scope.getListOfYearsFromNow(),$scope.pagesHistoy=0,$scope.getHistoryReport(!0)}),$scope.$on("event-error",function(e,t){$scope.error=!0,$scope.mgs_error=t}),$scope.tapShowSelectWeek=function(){setTimeout(function(){$(".select-week-dropdown").toggle()},10)},$scope.tapSelectYear=function(e){$scope.objYearSelected=e,fnSetYearSelected(),$scope.getListOfAllWeeksOfYear(e.yearNumber)},$scope.tapExportReport=function(){$scope.exportReport()},$scope.tapWeekNumber=function(e){$scope.objWeekSelected=e,fnSetWeekSelected()},$scope.tapShowSelectYear=function(){console.log($(".select-year-dropdown")),setTimeout(function(){$(".select-year-dropdown").toggle()},10)},$scope.endScrollHistory=function(){$scope.canLoadMoreHistory&&($scope.canLoadMoreHistory=!1,$scope.pagesHistoy++,$scope.getHistoryReport())}}function weeklyReportController(e,t,n,a,r,o,s,i,c,l,u){t.taskInfo=s,t.reportInfo=i,t.alerts=[],t.actionMode=c,t.reportActions=r,t.canSelectWeek=!0,c==r.VIEW&&(t.canSelectWeek=!1),t.reportInfo?l.weekSelected={week:t.reportInfo.week_number,year:t.reportInfo.year}:l.weekSelected={year:moment().year(),week:moment().week()},t.doneAction=function(){if(d()){o.start({message:"Đang xử lý..."});var r="POST",i=a.TASKS+"/"+s._id+"/comments";t.reportInfo._id&&(i=i+"/"+t.reportInfo._id,r="PUT");var c={comment:t.reportInfo.message,comment_type:2,next_plan:t.reportInfo.next_plan,result:t.reportInfo.result,week_number:l.weekSelected.week,year:l.weekSelected.year};u.postMethod(r,i,c).success(function(a){o.stop(),n.close(),t.actionMode===t.reportActions.CREATE?e.$broadcast("create-weekly-report-sucess",l.weekSelected):t.actionMode===t.reportActions.EDIT&&e.$broadcast("edit-weekly-report-sucess",l.weekSelected)}).error(function(e){if(o.stop(),e)if(e.errors&&e.errors.length>0){var n=e.errors[0];t.alerts.push({type:"danger",message:n.message})}else t.alerts.push({type:"danger",message:"Có lỗi xảy ra, vui lòng thử lại!"});else t.alerts.push({type:"danger",message:"Không kết nối được tới máy chủ, vui lòng thử lại!"})})}},t.currentWeek=function(){return l.weekSelected.week+"/"+l.weekSelected.year},t.nextWeek=function(){if(l.weekSelected.week===moment().weeksInYear()){var e=l.weekSelected.year+1;return"1/"+e}var t=l.weekSelected.week+1;return t+"/"+l.weekSelected.year},t.cancelAction=function(){n.close()},t.closeAlert=function(e){t.alerts.splice(e,1)};var d=function(){return t.reportInfo&&t.reportInfo.message&&t.reportInfo.message.trim()?t.reportInfo.result&&t.reportInfo.result.trim()?!(!t.reportInfo.next_plan||!t.reportInfo.next_plan.trim())||(t.alerts.push({type:"danger",message:"Không được để trống Kế hoạch tuần "+t.nextWeek()+"!"}),!1):(t.alerts.push({type:"danger",message:"Không được để trống Kết quả tuần "+t.currentWeek()+"!"}),!1):(t.alerts.push({type:"danger",message:"Không được để trống Kế hoạch tuần "+t.currentWeek()+"!"}),!1)}}function ModalInstanceCtrl(e,t,n,a,r,o,s,i,c,l,u,d,p,m,g,f,h,k,_){function v(){"supervisor"==L.type?(L.modalTitle="Chọn người giám sát",L.pageChanged=E,L.projectMembers()):"assignee"==L.type?(L.modalTitle="Chọn người thực hiện",L.pageChanged=E,L.projectMembers()):"assigner"==L.type?(L.modalTitle="Chọn người giao việc",L.pageChanged=E,L.projectMembers()):"organization"==L.type?(L.pageChanged=w,L.modalTitle="Danh sách cơ quan",L.getListOrg()):"dependency_main_task"!=L.type&&"dependency_sub_task"!=L.type&&"dependency_update_task"!=L.type||(L.pageChanged=I,L.modalTitle="Chọn công việc phụ thuộc",L.getDependencyTasks())}function y(){var e=g.API+i+"/members",t=_.getTasksList(g.METHOD,e,L.getParams(),g.HEADERS);t.success(function(e){n.debug("projectMembers: "),n.debug(e),L.membersProject=e.data.users,L.totalItems=e.data.total,L.currentPage=H.page,L.numPages=Math.ceil(e.data.total/H.perPage),L.perPage=H.perPage,L.selectedOwner&&$.each(L.membersProject,function(e,t){if(L.membersProject[e]._id===L.selectedOwner._id)return void(L.membersProject[e].is_selected=!0)})}).error(function(e){})}function D(){var e=_.getTasksList(h.METHOD,h.API,L.getParams(),h.HEADERS);e.success(function(e){L.organizations=e.data.organizations,L.total_user=e.data.total,L.totalItems=e.data.total,L.currentPage=H.page,L.numPages=Math.ceil(e.data.total/H.perPage),L.perPage=H.perPage}).error(function(e){})}function T(){var e=k.API;e+=d?"?parent="+d:u?"?task="+u:"?project="+i;var t=_.getTasksList(k.METHOD,e,L.getParamsDependency(),k.HEADERS);t.success(function(e){L.dependenciesTasks=e.data.tasks,n.debug(L.dependenciesTasks),L.total_user=e.data.total,L.totalItems=e.data.total,L.currentPage=H.page,L.numPages=Math.ceil(e.data.total/H.perPage),L.perPage=H.perPage}).error(function(e){n.debug(e)})}function b(){return{keyword:L.keyword,limit:L.limit,offset:0==L.currentPage?0:(L.currentPage-1)*L.limit}}function S(e){return"dependency_main_task"===e?(n.debug("depent main task"),{keyword:L.keyword,limit:L.limit,offset:0==L.currentPage?0:(L.currentPage-1)*L.limit,project:i}):"dependency_sub_task"===e?(n.debug("depent sub task"),{keyword:L.keyword,limit:L.limit,offset:0==L.currentPage?0:(L.currentPage-1)*L.limit,parent:u}):"dependency_update_task"===e?{keyword:L.keyword,limit:L.limit,offset:0==L.currentPage?0:(L.currentPage-1)*L.limit,task:u}:void 0}function E(){H.toPageId(L.currentPage),L.projectMembers()}function w(){H.toPageId(L.currentPage),L.getListOrg()}function I(){H.toPageId(L.currentPage),L.getDependencyTasks()}function P(){L.currentPage=0,L.getListItem()}function A(){a.dismiss("cancel")}function C(e){L.selectedOwner=e,$.each(L.membersProject,function(e,t){L.membersProject[e].is_selected=!1}),e.is_selected=!0}function O(){if(e.assignee=L.selectedOwner,n.debug(e.assignee),"supervisor"==L.type)t.$broadcast("selected-owner",L.selectedOwner);else if("assignee"==L.type)t.$broadcast("selected-assign",L.selectedOwner);else if("assigner"==L.type){L.ownerId=L.selectedOwner?L.selectedOwner._id:"";var r={owner:L.ownerId},s=o.postMethod(f.METHOD,L.updatePriorityUrl,r,f.HEADERS);s.success(function(e){t.$broadcast("selected-assign-work",L.selectedOwner),a.dismiss("cancel")}).error(function(e){t.$broadcast("selected-assign-work",!1),a.dismiss("cancel")})}a.dismiss("cancel")}function M(e){var t=L.selectedOrg.indexOf(e._id),n=L.organizations.indexOf(e);t>-1?(L.selectedOrg.splice(t,1),L.organizations[n].is_selected=!1):(L.selectedOrg.push(e._id),L.organizations[n].is_selected=!0)}function j(e){var t=L.selectedDepenTask.indexOf(e._id),n=L.dependenciesTasks.indexOf(e);t>-1?(L.selectedDepenTask.splice(t,1),L.dependenciesTasks[n].is_selected=!1):(L.selectedDepenTask.push(e._id),L.dependenciesTasks[n].is_selected=!0)}function R(e){if(!e)return!1;var t=L.selectedOrg.indexOf(e._id);return t>-1}function U(e){if(!e)return!1;var t=L.selectedDepenTask.indexOf(e._id);return t>-1}var L=this;L.selected=null,L.selectedOwner=c,L.selectedMember=c,L.selectOrg=M,L.selectDepenTasks=j,L.selectMember=C,L.projectMembers=y,L.getListOrg=D,L.getDependencyTasks=T,L.idProject=i,L.membersProject=[],L.organizations=[],L.dependenciesTasks=[],L.type=l,L.isSelected=R,L.isSelectedDepenTask=U,L.updatePriorityUrl=f.API+u,L.getParams=b,L.getParamsDependency=S,L.selectedOrg=p,e.selectedDepenTaskOrg=angular.copy(m),L.selectedDepenTask=m,L.doSearch=P,L.limit=5;var H=r.getNew(L.limit);L.currentPage=0,L.ok=A,L.completeSuper=O,L.getListItem=v,L.getListItem(),L.showOrg=function(e){return L.check=!0,"viewer"===l?$.each(L.member,function(t,n){if(n===e._id)return void(L.check=!1)}):$.each(L.viewer,function(t,n){if(n===e._id)return void(L.check=!1)}),L.check},L.showDependencyTasks=function(e){return L.check=!0,$.each(L.dependenciesTasks,function(t,n){if(n===e._id)return void(L.check=!1)}),L.check}}function BoxMainTasksCtrl(e,t,n,a,r,o,s,i,c,l,u,d,p,m){function g(){$ctrl.currentPage=0,$ctrl.getListUser()}function f(){T.toPageId($ctrl.currentPage),$ctrl.getListUser()}function h(){return{keyword:$ctrl.keyword,limit:$ctrl.limit,offset:0==$ctrl.currentPage?1:($ctrl.currentPage-1)*$ctrl.limit}}function k(){$ctrl.selectedTask=angular.copy($ctrl.selectedTask_old),l.dismiss("cancel")}function _(){$ctrl.selectedTask=[],$ctrl.myTaskTemplates=[];for(var t=$ctrl.taskTemplates.length-1;t>=0;t--)if($ctrl.taskTemplates[t].is_selected===!1)$ctrl.taskTemplates.splice(t,1);else{$ctrl.selectedTask.push($ctrl.taskTemplates[t]._id);var n=$ctrl.taskTemplates[t].children;if(n)for(var a=n.length-1;a>=0;a--)n[a].is_selected===!1?n.splice(a,1):$ctrl.selectedTask.push(n[a]._id)}e.$broadcast("select-task",$ctrl.selectedTask),e.$broadcast("list-main-task",$ctrl.taskTemplates),l.dismiss("cancel")}function v(){m.start({message:"Đang tải dữ liệu..."});var e=d.getTasksList(u.METHOD,u.API,$ctrl.iData(),u.HEADERS);e.success(function(e){if(e.data){if(e.data.templates){$ctrl.taskTemplates=e.data.templates,$ctrl.taskTemplates.isCollapsed=!1;for(var t=0;t<$ctrl.taskTemplates.length;t++)if($ctrl.selectedTask){var n=$ctrl.selectedTask.indexOf($ctrl.taskTemplates[t]._id);if(n>=0){$ctrl.taskTemplates[t].is_selected=!0;var a=$ctrl.taskTemplates[t].children;if(a)for(var r=0;r<a.length;r++)childrenTemplateTask=a[r],$ctrl.selectedTask.indexOf(childrenTemplateTask._id)>=0?a[r].is_selected=!0:a[r].is_selected=!1}else $ctrl.taskTemplates[t].is_selected=!1}else{$ctrl.taskTemplates[t].is_selected=!0;for(var a=$ctrl.taskTemplates[t].children,r=0;r<a.length;r++)a[r].is_selected=!0}$ctrl.totalItems=e.data.total,$ctrl.currentPage=T.page,$ctrl.numPages=Math.ceil(e.data.total/T.perPage),$ctrl.perPage=T.perPage}m.stop()}})}function y(e,t,n){var a=$ctrl.taskTemplates.indexOf(e);if("parent"===n){$ctrl.taskTemplates[a].is_selected=!$ctrl.taskTemplates[a].is_selected;for(var r=$ctrl.taskTemplates[a].children.length-1;r>=0;r--)$ctrl.taskTemplates[a].children[r].is_selected=$ctrl.taskTemplates[a].is_selected}else{var o=$ctrl.taskTemplates[a].children.indexOf(t);$ctrl.taskTemplates[a].children[o].is_selected=!$ctrl.taskTemplates[a].children[o].is_selected;for(var s=$ctrl.taskTemplates[a].is_selected,r=$ctrl.taskTemplates[a].children.length-1;r>=0;r--)if($ctrl.taskTemplates[a].children[r].is_selected){s=!0;break}$ctrl.taskTemplates[a].is_selected=s}}function D(e){if(!e)return!1;var t=$ctrl.selectedTask.indexOf(e._id);return t>-1}$ctrl=this,$ctrl.modalTitle=s,$ctrl.membersProject=[],$ctrl.getTaskTemplates=v,$ctrl.doSearch=g,$ctrl.keyword="",$ctrl.ok=_,$ctrl.cancel=k,$ctrl.viewer=i,$ctrl.member=c,$ctrl.mainTasks=r,$ctrl.selectedTask=angular.copy(a),$ctrl.taskTemplates=[],$ctrl.selectedTask_old=angular.copy($ctrl.selectedTask),$ctrl.isSelected=D,$ctrl.selectTask=y,$ctrl.iData=h,$ctrl.limit=5;var T=p.getNew($ctrl.limit);$ctrl.getTaskTemplates(),$ctrl.pageChanged=f,$ctrl.currentPage=0,$ctrl.showUser=function(e){return $ctrl.check=!0,"viewer"===o?$.each($ctrl.member,function(t,n){if(n===e._id)return void($ctrl.check=!1)}):$.each($ctrl.viewer,function(t,n){if(n===e._id)return void($ctrl.check=!1)}),$ctrl.check}}function isNumeric(e){var t=parseInt(e);return!(t<0)&&(!isNaN(t)&&isFinite(e))}function BoxUserSystemCtrl(e,t,n,a,r,o,s,i,c,l,u,d){function p(){$ctrl.currentPage=0,$ctrl.getListUser()}function m(){v.toPageId($ctrl.currentPage),$ctrl.getListUser()}function g(){return{keyword:$ctrl.keyword,limit:$ctrl.limit,offset:0==$ctrl.currentPage?0:($ctrl.currentPage-1)*$ctrl.limit}}function f(){$ctrl.selectedUser=angular.copy($ctrl.selectedUser_old),c.dismiss("cancel")}function h(){e.$broadcast("select-user",$ctrl.selectedUser),c.dismiss("cancel")}function k(){var e=u.getTasksList(l.METHOD,l.API,$ctrl.iData(),l.HEADERS);e.success(function(e){if(e.data&&e.data.users){$ctrl.members=e.data.users;for(var t=0;t<$ctrl.members.length;t++){var n=$ctrl.selectedUser.indexOf($ctrl.members[t]._id);n>-1&&($ctrl.members[t].is_selected=!0)}$ctrl.total_user=e.data.total,$ctrl.totalItems=e.data.total,$ctrl.currentPage=v.page,$ctrl.numPages=Math.ceil(e.data.total/v.perPage),$ctrl.perPage=v.perPage}})}function _(e){var t=$ctrl.members.indexOf(e);$ctrl.members[t].is_selected=!$ctrl.members[t].is_selected;var n=$ctrl.selectedUser.indexOf(e._id);n>-1?$ctrl.selectedUser.splice(n,1):$ctrl.selectedUser.push(e._id)}$ctrl=this,$ctrl.modalTitle=s,$ctrl.members=[],$ctrl.getListUser=k,$ctrl.doSearch=p,$ctrl.keyword="",$ctrl.ok=h,$ctrl.cancel=f,$ctrl.viewer=i,$ctrl.member=o,$ctrl.selectedUser=angular.copy(a),$ctrl.selectUser=_,$ctrl.iData=g,$ctrl.limit=5;var v=d.getNew($ctrl.limit);$ctrl.getListUser(),$ctrl.pageChanged=m,$ctrl.currentPage=0}function BaseLoadingController(e,t,n,a){var r=20;e.busy=!1,e.shouldLoadMore=!0,e.items=[],e.error=!1,e.errorMessage=!1,e.currentIndex=0,e.defaultLimit=r,e.keyword=null,e.url=null,e.loadMoreData=e.loadMoreData||function(){e.error=!1,!e.busy&&e.shouldLoadMore&&(e.busy=!0,n.loadData(e.url,e.generateParams(),e.generateHeaders()).success(function(t){e.busy=!1,e.handleSuccessResponse(t)}).error(function(t){e.busy=!1,o(t)}))},e.generateHeaders=function(){return{access_token:a.getAccessToken()}},e.generateParams=function(){var t=e.defaultParams();return e.extraParameters&&(t=angular.merge(t,e.extraParameters)),t},e.defaultParams=function(){return{keyword:e.keyword,limit:e.defaultLimit,offset:e.currentIndex}};var o=function(t){if(e.error=!0,t)if(t.errors&&t.errors.length>0){var n=t.errors[0];e.errorMessage=n.message}else e.errorMessage="Có lỗi xảy ra, vui lòng thử lại!";else e.errorMessage="Không kết nối được tới máy chủ, vui lòng thử lại!"}}function ItemsPopupCtroller(e,t,n,a,r,o,s,i,c,l,u){angular.extend(this,n("BaseLoadingController",{$scope:e}));var d=this;e.title=c,e.selectedItems=angular.copy(o),e.originalSelectedItems=o,e.multipleSelect=s,e.canSearch=i,e.popupType=l,e.searchResult=null,e.keyword="",e.cancelAction=function(){a.close()},e.doneAction=function(){e.originalSelectedItems.splice(0,e.originalSelectedItems.length),e.selectedItems.forEach(function(t){e.originalSelectedItems.push(t)}),a.dismiss()},e.searchAction=function(t){e.keyword=t,null!==e.keyword&&(e.shouldLoadMore=!0,e.currentIndex=0,e.loadMoreData())},e.selectItem=function(t){if(e.multipleSelect){var n=e.selectedItems.indexOf(t._id);n<0?(e.selectedItems.push(t._id),t.objectSelected=!0):(e.selectedItems.splice(n,1),t.objectSelected=!1)}else if(e.selectedItems.length>0){var a=e.selectedItems[0];e.items.forEach(function(e){e._id===a._id&&(e.objectSelected=!1)}),e.selectedItems.splice(0,e.selectedItems.length),a._id!==t._id&&(e.selectedItems.push(t),t.objectSelected=!0)}else e.selectedItems.push(t),t.objectSelected=!0},d.urlForPopupType=function(t){switch(t){case"organization":e.url=r.ORGANIZATIONS;break;case"task-dependency":e.extraParameters={parent:u.parentId,task:u.taskId,project:u.projectId},e.url=r.TASKDEPENDENCIES;break;case"supervisor":case"assignee":case"assigner":var n=u.projectId;e.url=r.PROJECTS+"/"+n+"/members";break;case"member":e.url=r.USERS}},e.handleSuccessResponse=e.handleSuccessResponse||function(t){if(e.error=!1,t){var n=d.retreiveDataForType(t.data);n&&n.length<e.defaultLimit&&(e.shouldLoadMore=!1),0===e.currentIndex&&(e.items=[]),n.forEach(function(t){e.items.push(t)}),e.currentIndex+=n.length,d.processAfterHandleSuccessResponse()}},d.processAfterHandleSuccessResponse=function(){e.items.forEach(function(t,n){if(e.multipleSelect){var a=e.selectedItems.indexOf(t._id);a<0?e.items[n].objectSelected=!1:e.items[n].objectSelected=!0}else e.selectedItems&&e.selectedItems.length>0&&e.selectedItems[0]._id===t._id?e.items[n].objectSelected=!0:e.items[n].objectSelected=!1})},d.retreiveDataForType=function(t){var n=null;if(t&&"object"==typeof t)switch(e.popupType){case"organization":n=t.organizations;break;case"task-dependency":n=t.tasks;break;case"supervisor":case"assignee":case"assigner":case"member":n=t.users}return n},d.urlForPopupType(e.popupType),e.loadMoreData()}function ConfirmDialogController(e,t,n,a){e.data=t,e.callback=n,e.okAction=function(){a.close(),e.callback(!0,t.extra)},e.cancelAction=function(){a.close(),e.callback(!1,t.extra)}}function userCtrl(e,t,n,a,r,o,s){function i(t,a){var r=e.userAvatar;n.updateUserAvatar(t,r,a)}e.limit=12,e.offset=0,e.busy=!1,e.finished=!1,e.userGender=[{name:"Nam",value:1},{name:"Nữ",value:2}],e.$on("$viewContentLoaded",function(){n.getListUser().length>0?e.users=n.getListUser():(t.start({message:"Đang xử lý ..."}),e.busy=!0,n.requestuserList({limit:e.limit,offset:e.offset},function(n){n.length<e.limit?e.finished=!0:e.offset=e.offset+n.length-1,e.users=n,e.busy=!1,t.stop()})),r.requestDepartmentServiceList(function(t){e.departments=t.departments,e.positions=t.positions})}),e.viewUserDetail=function(a){t.start({message:"Đang xử lý ..."}),n.getUserDetail(a._id,function(n){e.indexOfView=e.users.indexOf(a),e.userData=n,null!==a.avatar&&void 0!==a.avatar||(e.userData.avatar="./assets/img/icons/default_avatar.png"),e.userData.dob&&(e.userData.dob=new Date(n.dob)),e.userData.full_name="",n.last_name&&(e.userData.full_name=n.last_name),n.middle_name&&(e.userData.full_name=e.userData.full_name+" "+n.middle_name),n.first_name&&(e.userData.full_name=e.userData.full_name+" "+n.first_name),e.oldUserInfo=angular.copy(n),t.stop()})},e.removeUser=function(a){var r=e.getIndexOfObject(a._id);t.start({message:"Đang xử lý ..."}),n.deleteUser(a._id,function(n,a){a?(e.alertsMsg={type:"success",message:"Xóa người dùng thành công!"},e.message=a.message,e.userData=[],e.users.splice(r,1),e.UpdateUserListFromService()):e.alertsMsg={type:"danger",message:"Không thể xóa người dùng, vui lòng kiểm tra lại!"},t.stop(),o(function(){e.message=null,e.alertsMsg=null},2e3)})},e.updateUser=function(a){t.start({message:"Đang xử lý ..."});var r={},s=e.oldUserInfo;if(a._id===s._id){if(a.full_name!==s.full_name){r.last_name=a.full_name.split(" ").slice(0,1).join(" "),r.first_name=a.full_name.split(" ").slice(-1).join(" ");var i=a.full_name.replace(r.first_name,"").replace(r.last_name,"");/\S/.test(i)&&(r.middle_name=i)}a.address!==s.address&&(r.address=a.address),a.dob&&a.dob!==s.dob&&(r.dob=new Date(a.dob)),void 0!==a.gender&&Number(a.gender.value)!==Number(s.gender)&&(r.gender=Number(a.gender.value)),a.phone!==s.phone&&(r.phone=a.phone),a.department&&a.department._id&&(s.department&&a.department._id===s.department._id||(r.department=a.department._id)),a.position&&a.position._id&&(s.position&&a.position._id===s.position._id||(r.position=a.position._id)),r.user=a._id,n.updateUser(r,function(n,a){if(a){var s=e.getIndexOfObject(r.user);e.users[s]=a.data,e.UpdateUserListFromService(),e.message=a.message}else e.message=n.errors[0].message;t.stop(),o(function(){e.message=null},1e3)})}},e.resetUserInfoUpdate=function(){e.userData={}},e.resetUserNewUser=function(){},e.createUser=function(a){if(a&&a.email){if(a.full_name){a.last_name=a.full_name.split(" ").slice(0,1).join(" "),a.first_name=a.full_name.split(" ").slice(-1).join(" ");var r=a.full_name.replace(a.first_name,"").replace(a.last_name,"");/\S/.test(r)&&(a.middle_name=r)}a.dob&&(a.dob=new Date(a.dob)),void 0!==a.gender&&(a.gender=Number(a.gender.value)),a.department&&(a.department=a.department._id),a.position&&(a.position=a.position._id),t.start({message:"Đang xử lý ..."}),n.createUser(a,function(n,a){a?(e.userAvatar?i(a.data._id,function(n,a){e.users.unshift(a.data),e.message=a.message,t.stop()}):(e.users.unshift(a.data),e.message=a.message,e.UpdateUserListFromService(),t.stop()),e.newUser={}):(e.message=n.errors[0].message,t.stop()),o(function(){e.message=null},1e3)})}},e.loadMoreUserData=function(){e.busy||e.finished||(e.busy=!0,n.requestuserList({limit:e.limit,offset:e.offset},function(t){t.length<e.limit?e.finished=!0:e.offset=e.offset+t.length-1,t.forEach(function(t){e.users.push(t)}),e.UpdateUserListFromService(),e.busy=!1}))},e.UpdateUserListFromService=function(){n.updateUserList(e.users)},e.getIndexOfObject=function(t){for(var n=0;n<e.users.length;n+=1)if(e.users[n]._id===t)return n;return-1}}function organizationCtrl(e,t,n,a,r){e.limit=12,e.offset=0,e.busy=!1,e.finished=!1,e.$on("$viewContentLoaded",function(){e.busy=!0,n.requestOrganizationList({limit:e.limit,offset:e.offset},function(t){e.organizations=t,e.busy=!1})}),e.viewOrgDetail=function(t){e.organization=angular.copy(t)},e.updateOrganizationInfo=function(a){t.start({message:"Đang tải dữ liệu..."}),n.updateOrganization(a._id,a,function(n,o){o?(e.message=o.message,e.organizations.forEach(function(e){e._id===a._id&&(e.name=o.data.name,e.address=o.data.address)})):e.message=n.errors[0].message,t.stop(),r(function(){e.message=null},1e3)})},e.createNewOrg=function(t){t&&t.name&&t.address&&n.createOrganization(t,function(t,n){n?(e.message=n.message,e.organizations.unshift(n.data),e.newORG.name=null,e.newORG.address=null):e.message=t,r(function(){e.message=null},1e3)})},e.deleteNewOrg=function(t){n.deleteOrganization(t,function(n,a){a?(e.alertsMsg={type:"success",message:"Xóa  cơ quan thành công!"},e.message=a,e.organizations.forEach(function(n){n._id==t&&(e.organization=[],e.organizations.splice(e.organizations.indexOf(n),1))})):(e.message=n,e.alertsMsg={type:"danger",message:"Không thể xóa cơ quan này, vui lòng kiểm tra lại!"}),r(function(){e.message=null,e.alertsMsg=null},1e3)})},e.loadMoreOrgData=function(){e.busy||e.finished||(e.busy=!0,n.requestOrganizationList({limit:e.limit,offset:e.offset},function(t){t.length<e.limit?e.finished=!0:e.offset=e.offset+t.length-1,t.forEach(function(t){e.organizations.push(t)}),e.busy=!1}))}}function handelActivedNav(e){var t={project:{hightling:"./assets/img/icons/icn-highlight-project.png",normal:"./assets/img/icons/icn-project.png"},task:{hightling:"./assets/img/icons/icn-highlight-congviec.png",normal:"./assets/img/icons/icn-congviec.png"},report:{hightling:"./assets/img/icons/icon-report-highlight.png",normal:"./assets/img/icons/icon-report.png"},schedule:{hightling:"./assets/img/icons/icn-highlight-lich.png",normal:"./assets/img/icons/icn-lich.png"},users:{hightling:"./assets/img/admin/active-admin-icon.png",normal:"./assets/img/admin/normal-admin-icon.png"},organizations:{hightling:"./assets/img/admin/active-admin-icon.png",normal:"./assets/img/admin/normal-admin-icon.png"}};return{link:function(n,a,r){n.isShowedChildMenu=!1,"users"==e.current.parent||"organizations"==e.current.parent?(t.users.normal="./assets/img/admin/active-admin-icon.png",n.isShowedChildMenu=!0):(n.isShowedChildMenu=!1,t.users.normal="./assets/img/admin/normal-admin-icon.png");var o=e.current.parent,s=r.parent;a.removeClass("active");var i=a.find("img");i.attr("src",t[s].normal),o===s&&(a.addClass("active"),i.attr("src",t[s].hightling))}}}function editDocument(e){return{restrict:"A",scope:{document:"="},link:function(t,n,a){$(n).click(function(){e.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/add-document.html",controller:"ModalAddDocumentCtrl",controllerAs:"$ctrl",resolve:{items:function(){return t.projectId},documentFor:function(){return 0},documents:function(){return 0},method:function(){return"edit"},data:function(){return t.document}}})})}}}function showDocument(e){return{restrict:"A",scope:{document:"="},link:function(t,n,a){$(n).click(function(){console.log("element document: "),console.log(n);e.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/shared/layout/show-document.html",controller:"ModalAddDocumentCtrl",controllerAs:"$ctrl",resolve:{items:function(){return t.projectId},documentFor:function(){return 0},documents:function(){return 0},method:function(){return"show"},data:function(){return t.document}}})})}}}var translationsVI={DOWNLOAD_APP_APPLE:"Tải ứng dụng từ Appstore",DOWNLOAD_APP_ANDROID:"Tải ứng dụng từ Google Play"},tamagoApp=angular.module("tamago",["ui.router","ui.bootstrap","pascalprecht.translate","simplePagination","angular-nicescroll","cm.filter","blockUI","$strap.directives","infinite-scroll"]);tamagoApp.config(["$logProvider","$translateProvider","blockUIConfig","$httpProvider",function(e,t,n,a){e.debugEnabled(!0),a.interceptors.push("authInterceptor"),t.translations("vi",translationsVI),t.preferredLanguage("vi"),t.fallbackLanguage("vi"),n.autoBlock=!1}]),tamagoApp.run(["$rootScope","$location","$state","commonValues",function(e,t,n,a){e.$on("$stateChangeStart",function(n,r,o,s,i){e.isProjectManager=!1,"project_manager"===a.getRole()&&(e.isProjectManager=!0);var c=localStorage.accessToken;void 0===c&&t.path("/login")}),e.shareData={createTask:!1,new_task:""}}]),tamagoApp.factory("authInterceptor",["$q","commonValues","$location","$rootScope",function(e,t,n,a){return{responseError:function(t){return 403===t.status?(n.path("/login"),e.reject(t)):e.reject(t)}}}]);var domain="https://tamago.work:8090/",headers={"Content-Type":"application/json"},APP_INFO={URL:window.location.origin};tamagoApp.constant("LOGIN",{METHOD:"POST",API:domain+"auth/login",HEADERS:headers}).constant("LOGOUT",{METHOD:"GET",API:domain+"auth/logout",HEADERS:headers}).constant("TASKS_LIST",{METHOD:"GET",API:domain+"tasks",HEADERS:headers}).constant("TASKS_DETAIL",{METHOD:"GET",API:domain+"tasks/",HEADERS:headers}).constant("PROJECTS_CREATE",{METHOD:"POST",API:domain+"projects/",HEADERS:headers}).constant("PROJECTS_EDIT",{METHOD:"PUT",API:domain+"projects/",HEADERS:headers}).constant("PROJECTS_LIST",{METHOD:"GET",API:domain+"projects",HEADERS:headers}).constant("PROJECTS_DETAIL",{METHOD:"GET",API:domain+"projects/",HEADERS:headers}).constant("PROJECTS_TASK",{METHOD:"GET",API:domain+"projects/",HEADERS:headers}).constant("PROJECTS_MEMBER",{METHOD:"GET",API:domain+"projects/",HEADERS:headers}).constant("GET_COMMENTS",{METHOD:"GET",API:domain+"tasks/",HEADERS:headers}).constant("POST_COMMENTS",{METHOD:"POST",API:domain+"tasks/",HEADERS:headers}).constant("CHILDREN_TASKS",{METHOD:"GET",API:domain+"tasks/",HEADERS:headers}).constant("PUT_PRIORITY",{METHOD:"PUT",API:domain+"tasks/",HEADERS:headers}).constant("GET_USERS",{METHOD:"GET",API:domain+"users",HEADERS:headers}).constant("ADD_DOCUMENT",{METHOD:"POST",API:domain+"documents",HEADERS:headers}).constant("UPDATE_DOCUMENT",{METHOD:"PUT",API:domain+"documents/",HEADERS:headers}).constant("TASK_CREATE",{METHOD:"POST",API:domain+"tasks",HEADERS:headers}).constant("TASK_EDIT",{METHOD:"PUT",API:domain+"tasks/",HEADERS:headers}).constant("GET_DOCUMENT",{METHOD:"GET",API:domain+"documents",HEADERS:headers}).constant("GET_ORG",{METHOD:"GET",API:domain+"organizations",HEADERS:headers}).constant("GET_TASK_TEMPLATES",{METHOD:"GET",API:domain+"tasktemplates",
HEADERS:headers}).constant("DELETE_TASK",{METHOD:"DELETE",API:domain+"tasks/",HEADERS:headers}).constant("DEPENDENCY_TASK",{METHOD:"GET",API:domain,HEADERS:headers}).constant("GET_DEPENDENCY_TASK",{METHOD:"GET",API:domain+"dependencies",HEADERS:headers}).constant("STORAGE_KEYS",{PROJECT_STAUS_KEY:"project_status_key",TASK_STAUS_KEY:"task_status_key"}).constant("EXPORT_REPORT",{METHOD:"GET",API:domain+"export/",HEADERS:headers}),tamagoApp.constant("LIST_STATUS",{recently:{icon:"./assets/img/icons/New_96.png",name:"Mới nhận",id:0},working:{icon:"./assets/img/icons/inprogress_icn.png",name:"Đang làm",id:1},late:{icon:"./assets/img/icons/deadline_icon.png",name:"Trễ hạn",id:6},finish:{icon:"./assets/img/icons/Done_icon.png",name:"Hoàn thành",id:2},all:{icon:"./assets/img/icons/icn-gridview.png",name:"Tất cả",id:""}}).constant("LIST_SORT",{date:{icon:"./assets/img/icons/icn-start-date.png",name:"Ngày bắt đầu",id:0},normal:{icon:"./assets/img/icons/tre_cin.png",name:"Độ ưu tiên",id:1},lated:{icon:"./assets/img/icons/deadline_icon.png",name:"Ngày kết thúc",id:2}}).constant("PROJECT_LIST_SORT",{start_date:{icon:"./assets/img/icons/icn-start-date.png",name:"Ngày bắt đầu",id:0},name:{icon:"./assets/img/icons/project_name_icon.png",name:"Tên dự án",id:1},end_date:{icon:"./assets/img/icons/deadline_icon.png",name:"Ngày kết thúc",id:2}}).constant("TASK_STATUS",{NEW:0,INPROGERSS:1,DONE:2,REOPEN:3,CANCEL:4,HOLD:5}).constant("REPORT_ACTION",{VIEW:0,EDIT:1,CREATE:2}),tamagoApp.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/login"),e.state("base",{abstract:!0,url:"",templateUrl:"app/shared/layout/base.html"}).state("login",{url:"/login",parent:"base",templateUrl:"app/components/auth/login.html",controller:"loginController"}).state("dashboard",{url:"/dashboard",parent:"base",templateUrl:"app/shared/layout/dashboard.html",controller:"searchController"}).state("project",{url:"/dashboard",templateUrl:"app/shared/layout/dashboard.html",controller:"searchController"}).state("dashboard.project-list",{url:"/project-list",parent:"project",templateUrl:"app/components/projects/projects-list.html",controller:"projectListController"}).state("dashboard.project-infomation",{url:"/projects/:idProject/:nameTab",parent:"project",templateUrl:"app/components/projects/show-project-information.html",controller:"projectDetailController"}).state("dashboard.create-project",{url:"/create-project",parent:"project",templateUrl:"app/components/projects/create-new-project.html"}).state("dashboard.project-create",{url:"/project-create",parent:"project",templateUrl:"app/components/projects/project-create.html",controller:"projectCreateController"}).state("dashboard.edit-project",{url:"/edit-project/:idProject",parent:"project",templateUrl:"app/components/projects/project-edit.html",controller:"projectEditController"}).state("dashboard.task-create",{url:"/task-create/:idProject",parent:"project",templateUrl:"app/components/tasks/task-create.html",controller:"taskCreateController",resolve:{addFor:function(){return"task"}}}).state("task",{url:"/dashboard",templateUrl:"app/shared/layout/dashboard.html"}).state("dashboard/task-list",{url:"/task-list",parent:"task",templateUrl:"app/components/tasks/task-list.html",controller:"taskListController"}).state("dashboard.task-detail",{url:"/tasks/:idTask",parent:"task",templateUrl:"app/components/tasks/task-detail.html",controller:"taskDetailController"}).state("dashboard.search",{url:"/search",parent:"dashboard"}).state("dashboard.sub-task-create",{url:"/task-create/:idProject/:idTask",parent:"project",templateUrl:"app/components/tasks/task-create.html",controller:"taskCreateController"}).state("dashboard.edit-task",{url:"/edit-task/:idTask",parent:"task",templateUrl:"app/components/tasks/task-edit.html",controller:"taskEditController"}).state("profile",{url:"/dashboard",parent:"base",templateUrl:"app/shared/layout/dashboard.html"}).state("dashboard.user-profile",{url:"/profile",parent:"profile",templateUrl:"app/components/profile/user-profile.html",controller:""}).state("report",{url:"/dashboard",templateUrl:"app/shared/layout/dashboard.html"}).state("dashboard/report-export",{url:"/report-export",parent:"report",templateUrl:"app/components/reports/export-report.html",controller:"exportReportController"}).state("users",{url:"/dashboard",templateUrl:"app/shared/layout/dashboard.html"}).state("dashboard/users",{url:"/users",parent:"users",templateUrl:"app/components/users/user-list.html",controller:"userCtrl"}).state("dashboard/users/create",{url:"/users/create",parent:"users",templateUrl:"app/components/users/create.html",controller:"userCtrl"}).state("organizations",{url:"/dashboard",templateUrl:"app/shared/layout/dashboard.html"}).state("dashboard/organizations",{url:"/organizations",parent:"organizations",templateUrl:"app/components/organizations/organization-list.html",controller:"organizationCtrl"})}]),Date.prototype.getWeek=function(){return moment().week()-12},tamagoApp.controller("loginController",["$translate","$scope","$location","$window","$log","postCommonService","commonValues","blockUI","LOGIN","$rootScope",loginController]),tamagoApp.controller("logoutController",["$scope","$location","$log","getCommonService","commonValues","LOGOUT","STORAGE_KEYS",logoutController]),tamagoApp.controller("taskListController",taskListController),taskListController.$inject=["$scope","$log","$filter","$location","$window","Pagination","commonValues","getTasksListService","TASKS_LIST","blockUI","LIST_STATUS","LIST_SORT","STORAGE_KEYS","$sce"],tamagoApp.controller("taskDetailController",["$scope","$rootScope","$timeout","$stateParams","$state","$log","$location","$anchorScroll","$uibModal","PROJECTS_DETAIL","getCommonService","postCommonService","getTasksListService","deleteService","commonValues","TASKS_DETAIL","Pagination","GET_COMMENTS","POST_COMMENTS","CHILDREN_TASKS","PUT_PRIORITY","PROJECTS_MEMBER","DELETE_TASK","TASK_STATUS","REPORT_ACTION","orderByFilter","blockUI","blockUIConfig",taskDetailController]);var convertDate=function(e){var t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear(),r=t+"/"+n+"/"+a;return r},getTimeComment=function(e){var t=new Date(e),n=t.getHours(),a=t.getMinutes();a<10&&(a="0"+a);var r=n+":"+a;return r};tamagoApp.controller("projectListController",projectListController),projectListController.$inject=["$scope","$log","Pagination","getTasksListService","commonValues","PROJECTS_LIST","blockUI","blockUIConfig","LIST_STATUS","PROJECT_LIST_SORT","STORAGE_KEYS"],tamagoApp.controller("projectDetailController",["$scope","$stateParams","$log","$location","Pagination","commonValues","getCommonService","getTasksListService","PROJECTS_DETAIL","PROJECTS_TASK","blockUI","blockUIConfig","$uibModal","postCommonService","$timeout",projectDetailController]),tamagoApp.controller("ModalAddDocumentCtrl",ModalAddDocumentCtrl),ModalAddDocumentCtrl.$inject=["$uibModalInstance","$log","$uibModal","$rootScope","$scope","postCommonService","ADD_DOCUMENT","UPDATE_DOCUMENT","items","documentFor","documents","method","data"],tamagoApp.controller("DocumentController",DocumentController),DocumentController.$inject=["$scope","$stateParams","$log","$location","Pagination","getCommonService","getTasksListService","PROJECTS_DETAIL","PROJECTS_TASK","TASKS_DETAIL","blockUI","blockUIConfig","$uibModal"],tamagoApp.controller("searchController",searchController),searchController.$inject=["$scope","$log","$location","$timeout","Pagination","getTasksListService","commonValues","TASKS_LIST","GET_USERS","PROJECTS_LIST","GET_DOCUMENT","$q"],tamagoApp.controller("projectCreateController",projectCreateController),projectCreateController.$inject=["$scope","$log","postCommonService","PROJECTS_CREATE","commonValues","$http","$rootScope","$state","$uibModal","blockUI"],tamagoApp.controller("projectEditController",projectEditController),projectEditController.$inject=["$scope","$log","postCommonService","PROJECTS_DETAIL","PROJECTS_EDIT","PROJECTS_CREATE","commonValues","$http","$rootScope","$state","getCommonService","$stateParams","$filter","$uibModal","blockUI","getTasksListService"],tamagoApp.controller("projectInfoController",projectInfoController),projectInfoController.$inject=["$scope","$log","$uibModal","Pagination","getTasksListService","commonValues","PROJECTS_LIST","blockUI","blockUIConfig","LIST_STATUS","PROJECT_LIST_SORT"],tamagoApp.controller("ModalTasksCtrl",ModalTasksCtrl),tamagoApp.controller("taskCreateController",["$rootScope","$scope","$log","$uibModal","$stateParams","$state","$location","$translate","postCommonService","getTasksListService","TASK_CREATE","PROJECTS_MEMBER","ADD_DOCUMENT","getCommonService","commonValues","TASKS_DETAIL","blockUI",taskCreateController]);var $ctrl=this;$ctrl.animationsEnabled=!0,$ctrl.items=["item1","item2","item3"];var convertDate=function(e){var t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear();t<10&&(t="0"+t),n<10&&(n="0"+n);var r=a+"-"+n+"-"+t;return r};tamagoApp.controller("taskEditController",["$rootScope","$scope","$log","$uibModal","$stateParams","$state","$location","postCommonService","getTasksListService","TASK_EDIT","PROJECTS_MEMBER","ADD_DOCUMENT","getCommonService","commonValues","blockUI","TASKS_DETAIL","DEPENDENCY_TASK",taskEditController]);var $ctrl=this;$ctrl.animationsEnabled=!0,$ctrl.items=["item1","item2","item3"];var convertDate=function(e){var t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear();t<10&&(t="0"+t),n<10&&(n="0"+n);var r=a+"-"+n+"-"+t;return r};tamagoApp.controller("BoxResonChange",BoxResonChange),tamagoApp.controller("exportReportController",exportReportController),exportReportController.$inject=["$scope","getTasksListService","EXPORT_REPORT","blockUI"],tamagoApp.controller("weeklyReportController",weeklyReportController),weeklyReportController.$inject=["$rootScope","$scope","$uibModalInstance","URL_VALUES","REPORT_ACTION","blockUI","taskInfo","reportInfo","actionMode","weekSelectService","postCommonService"],tamagoApp.controller("ModalInstanceCtrl",ModalInstanceCtrl),ModalInstanceCtrl.$inject=["$scope","$rootScope","$log","$uibModalInstance","Pagination","postCommonService","ADD_DOCUMENT","projectId","selectedMember","type","taskId","parentId","selectedOrgs","selectedDependencyTasks","PROJECTS_MEMBER","PUT_PRIORITY","GET_ORG","GET_DEPENDENCY_TASK","getTasksListService"],tamagoApp.controller("BoxMainTasksCtrl",BoxMainTasksCtrl),BoxMainTasksCtrl.$inject=["$rootScope","$scope","$log","items","mainTasks","type","title","viewer","member","$uibModalInstance","GET_TASK_TEMPLATES","getTasksListService","Pagination","blockUI"],Date.prototype.yyyymmdd=function(){var e=this.getMonth()+1<10?"0"+(this.getMonth()+1):this.getMonth()+1,t=this.getDate()<10?"0"+this.getDate():this.getDate();return[this.getFullYear(),e,t].join("-")},tamagoApp.controller("BoxUserSystemCtrl",BoxUserSystemCtrl),BoxUserSystemCtrl.$inject=["$rootScope","$scope","$log","items","type","member","title","viewer","$uibModalInstance","GET_USERS","getTasksListService","Pagination"],tamagoApp.controller("BaseLoadingController",BaseLoadingController),BaseLoadingController.$inject=["$scope","$log","LoadDataService","commonValues"],tamagoApp.controller("ItemsPopupCtroller",ItemsPopupCtroller),ItemsPopupCtroller.$inject=["$scope","$rootScope","$controller","$uibModalInstance","URL_VALUES","selectedItems","multipleSelect","canSearch","title","popupType","extraData"],tamagoApp.controller("ConfirmDialogController",ConfirmDialogController),ConfirmDialogController.$inject=["$scope","data","callback","$uibModalInstance"],tamagoApp.controller("userCtrl",["$scope","blockUI","usersService","URL_VALUES","departmentService","$timeout","$http",userCtrl]),tamagoApp.directive("userinfo",function(){return{scope:{},template:'<input ng-click="active = $id" ng-class="{active: $id === active, someclass: $id !== active }">',replace:!0,transclude:!0,link:function(e,t,n){}}}),tamagoApp.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var r=e(a.fileModel),o=r.assign;n.bind("change",function(){t.$apply(function(){o(t,n[0].files[0])})})}}}]),tamagoApp.factory("usersService",["$http","$httpParamSerializer","commonValues","URL_VALUES","COMMON_ACTION",function(e,t,n,a,r){function o(t,a,r,o){var s=n.getAccessToken();return s&&(o.access_token=s),e({method:t,url:a,params:r,headers:o})}var s=[],i=function(e,t){var n=o(r.GET_LIST,a.USERS,e,{});n.success(function(e){s=e.data.users,t(e.data.users)}).error(function(){})},c=function(e,t){var n=a.USERS+"/"+e,s={},i="",c=o(r.GET_DETAIL,n,i,s);c.success(function(e){t(e.data)}).error(function(){})},l=function(){return s},u=function(t,o){var s={},i=n.getAccessToken();i&&(s.access_token=i);var c=e({method:r.CREATE,url:a.USERS,data:t,headers:s});c.success(function(e){o(null,e)}).error(function(e){o(e,null)})},d=function(t,o){var s=a.USERS+"/update-profile",i={},c=n.getAccessToken();c&&(i.access_token=c);var l=e({method:r.UPDATE,url:s,data:t,headers:i});l.success(function(e){o(null,e)}).error(function(e){o(e,null)})},p=function(e,t){var n=a.USERS+"/"+e,s=o(r.DELETE,n,"",{});s.success(function(e){t(null,e)}).error(function(e){t(e,null)})},m=function(t,r,o){var s=new FormData;s.append("photo",r),s.append("user",t);var i=a.USERS+"/update-avatar",c=n.getAccessToken();e.post(i,s,{transformRequest:angular.identity,headers:{"Content-Type":void 0,access_token:c}}).success(function(e){o(null,e)}).error(function(e){o(e,null)})},g=function(e){s=e};return{requestuserList:i,getListUser:l,getUserDetail:c,createUser:u,updateUser:d,deleteUser:p,updateUserAvatar:m,updateUserList:g}}]),tamagoApp.constant("COMMON_ACTION",{GET_LIST:"GET",GET_DETAIL:"GET",CREATE:"POST",UPDATE:"PUT",DELETE:"DELETE"}),tamagoApp.factory("departmentService",["$http","$httpParamSerializer","commonValues","URL_VALUES","COMMON_ACTION",function(e,t,n,a,r){function o(t,a,r,o){var s=n.getAccessToken();return s&&(o.access_token=s),e({method:t,url:a,params:r,headers:o})}var s=[],i=[],c=function(e){var t=o(r.GET_LIST,a.DEPARTMENTS,"",{});t.success(function(t){s=t.data.departments,i=t.data.positions,e(t.data)}).error(function(){})},l=function(){return s};return{requestDepartmentServiceList:c,getDepartmentLists:l}}]),tamagoApp.factory("organizationService",["$http","$httpParamSerializer","commonValues","URL_VALUES","COMMON_ACTION",function(e,t,n,a,r){function o(t,a,r,o){var s=n.getAccessToken();return s&&(o.access_token=s),e({method:t,url:a,params:r,headers:o})}var s=[],i=function(e,t){var n=o(r.GET_LIST,a.ORGANIZATIONS,e,{});n.success(function(e){s=e.data.organizations,t(e.data.organizations)}).error(function(){})},c=function(e,t){var n=a.ORGANIZATIONS+"/"+e,s={},i="",c=o(r.GET_DETAIL,n,i,s);c.success(function(e){t(e.data)}).error(function(){})},l=function(){return s},u=function(t,o){var s={},i=n.getAccessToken();i&&(s.access_token=i);var c=e({method:r.CREATE,url:a.ORGANIZATIONS,data:t,headers:s});c.success(function(e){o(null,e)}).error(function(e){o(e.errors[0].message,null)})},d=function(t,o,s){var i=a.ORGANIZATIONS+"/"+t,c={},l=n.getAccessToken();l&&(c.access_token=l);var u=e({method:r.UPDATE,url:i,data:o,headers:c});u.success(function(e){s(null,e)}).error(function(e){s(e,null)})},p=function(e,t){var n=a.ORGANIZATIONS+"/"+e,s=o(r.DELETE,n,"",{});s.success(function(e){t(null,e.message)}).error(function(e){t(e.errors[0].message)})};return{requestOrganizationList:i,getOrganizationLists:l,getOrganizationDetail:c,createOrganization:u,updateOrganization:d,deleteOrganization:p}}]),tamagoApp.controller("organizationCtrl",["$scope","blockUI","organizationService","URL_VALUES","$timeout",organizationCtrl]),tamagoApp.factory("postCommonService",["$http","commonValues",function(e,t){var n=function(n,a,r,o){var s=t.getAccessToken();return s&&(o?o.access_token=s:o={access_token:s}),e({method:n,url:a,data:r,headers:o})},a=function(n,a,r,o){var s=t.getAccessToken();return s&&(o.access_token=s),e({method:n,url:a,data:r,headers:o,withCredentials:!1,transformRequest:angular.identity})};return{postMethod:n,uploadMethod:a}}]),tamagoApp.factory("deleteService",["$http","commonValues",function(e,t,n){var a=function(n,a,r){var o=t.getAccessToken();return o&&(r.access_token=o),e({method:n,url:a,headers:r})};return{deleteMethod:a}}]),tamagoApp.factory("getCommonService",["$http","commonValues",function(e,t,n){var a=function(n,a,r){var o=t.getAccessToken();return o&&(r.access_token=o),e({method:n,url:a,headers:r})};return{getMethod:a}}]),tamagoApp.factory("LoadDataService",["$http","commonValues",function(e,t){var n=function(n,a,r){var o=t.getAccessToken();return o&&r&&(r.access_token=o),e({method:"GET",url:n,params:a,headers:r})};return{loadData:n}}]),tamagoApp.factory("getTasksListService",["$http","$httpParamSerializer","commonValues",function(e,t,n){var a=function(t,a,r,o){var s=n.getAccessToken();return s&&(o.access_token=s),e({method:t,url:a,params:r,headers:o})};return{getTasksList:a}}]),tamagoApp.factory("commonValues",[function(){this.linkAvatar="./assets/img/icons/default_avatar.png";var e={key:"",value:""};return{setRole:function(e){localStorage.role=e},getRole:function(){return localStorage.role},setAccessToken:function(e){localStorage.accessToken=e},getAccessToken:function(){return localStorage.accessToken},setUserName:function(e){localStorage.userName=e},getUserName:function(){return localStorage.userName},setUserAvatar:function(e){localStorage.userAvatar=e},getUserAvatar:function(){return localStorage.userAvatar},setUserId:function(e){localStorage.userId=e},getUserId:function(){return localStorage.userId},removeAccessToken:function(){delete localStorage.accessToken},getCanCreateProject:function(){return localStorage.canCreateProject},setCanCreateProject:function(e){e?localStorage.canCreateProject=1:localStorage.canCreateProject=0},getCanCreateMainTask:function(){return localStorage.canCreateMainTask},setCanCreateMainTask:function(e){console.log("canCreateMainTask:"+e),e?localStorage.canCreateMainTask=1:localStorage.canCreateMainTask=0},setData:function(t,n){e.key=t,e.value=n},getData:function(){return e},setObject:function(e,t){localStorage.setItem(e,JSON.stringify(t))},getObject:function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null},removeData:function(){e={key:"",value:""}}}}]),tamagoApp.factory("weekSelectService",[function(){var e=new Date;this.weekSelected={year:e.getFullYear(),week:e.getWeek()};return{weekSelected:this.weekSelected}}]),function(){var e=angular.module("cm.filter",[]);e.filter("formatDate",function(){return function(e,t){if(!e||"undefined"==typeof e)return t;var n=new Date(e),a=n.getDate()<10?"0"+n.getDate():n.getDate(),r=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,o=n.getFullYear(),s=a+"/"+r+"/"+o;return s}}),e.filter("timeComment",function(){return function(e,t){if(!e||"undefined"==typeof e)return t;var n=new Date(e),a=n.getHours(),r=n.getMinutes();r<10&&(r="0"+r);var o=a+":"+r;return o}}),e.filter("formatFullDate",function(){var e=[],t=[];return function(n,a){var r=new Date(n),o="",s=r.getDay();switch(s){case 1:o="Thứ Hai";break;case 2:o="Thứ Ba";break;case 3:o="Thứ Tư";break;case 4:o="Thứ Năm";break;case 5:o="Thứ Sáu";break;case 6:o="Thứ Bảy";break;case 0:o="Chủ Nhật"}var i=r.getDate()<10?"0"+r.getDate():r.getDate(),c=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,l=r.getFullYear(),u=o+", "+i+"/"+c+"/"+l;return t.indexOf(a)===-1?(t.push(a),e.push(u),u):t.indexOf(a)>-1&&e.indexOf(u)===-1?(e.push(u),u):""}}),e.filter("formatTime",function(){return function(e){return moment.updateLocale("vi",{relativeTime:{future:"còn %s",past:"trễ %s",s:"vài giây",m:"1 phút",mm:"%d phút",h:"1 giờ",hh:"%d giờ",d:"1 ngày",dd:"%d ngày",M:"1 tháng",MM:"%d tháng",y:"1 năm",yy:"%d năm"}}),moment(e).fromNow(!0)}}),e.filter("taskStatus",function(){return function(e,t){var n=null;switch(t){case 0:n="Mới nhận";break;case 2:n="Hoàn thành";break;case 3:n="Mở lại";break;case 4:n="Đã huỷ";break;case 5:n="Tạm dừng"}return n?n:(moment.updateLocale("vi",{relativeTime:{future:"Còn %s",past:"Trễ %s",s:"0 ngày",m:"0 ngày",mm:"0 ngày",h:"0 ngày",hh:"0 ngày",d:"1 ngày",dd:"%d ngày",M:"1 tháng",MM:"%d tháng",y:"1 năm",yy:"%d năm"}}),moment(e).startOf("days").isSame(moment().startOf("days"),"day")?"Hết hạn hôm nay":moment(e).startOf("days").from(moment().startOf("days")))}}),e.filter("photo",function(){return function(e){return null===e||""===e?"./assets/img/icons/project_img_icon.png":e}}),e.filter("congVanIcon",function(){return function(e){switch(e){case 0:return"./assets/img/icons/in_document.png";case 1:return"./assets/img/icons/out_document.png";case 2:return"./assets/img/icons/output_document.png"}}}),e.filter("priority",function(){return function(e){switch(e){case 0:return"circle-prior-low";case 1:return"circle-prior-normal";case 2:return"circle-prior-hight";case 3:return"circle-prior-urgent"}}}),e.filter("taskStatusIcon",function(){return function(e){var t=e.status,n="./assets/img/icons/icn-clock.png";switch(t){case 0:n=1===e.dependency?"./assets/img/icons/dependency_task_status.png":2===e.dependency?"./assets/img/icons/dependency_task_status.png":"./assets/img/icons/New_icn.png";break;case 1:n="./assets/img/icons/progress_icon.png";break;case 2:n="./assets/img/icons/done_status.png";break;case 3:n="./assets/img/icons/reopen_status.png";break;case 4:n="./assets/img/icons/cancel_status.png";break;case 5:n="./assets/img/icons/pause_status.png"}return n}}),e.filter("cutString",function(){return function(e,t,n,a){if(!e)return"";if(n=parseInt(n,10),!n)return e;if(e.length<=n)return e;if(e=e.substr(0,n),t){var r=e.lastIndexOf(" ");r!=-1&&("."!=e.charAt(r-1)&&","!=e.charAt(r-1)||(r-=1),e=e.substr(0,r))}return e+(a||" …")}}),e.filter("filterProjectName",function(){return function(e){var t=$(".project-info-task-list-panel").width(),n=t/10-3,a="";return a=e.length>n?e.substr(0,n)+"...":e}}),e.filter("filterTaskName",function(){return function(e){var t=$(".task-list-panel").width(),n=t/10-3,a="";return a=e.length>n?e.substr(0,n)+"...":e}}),e.filter("titleTaskClass",function(){return function(e,t){return 0!==t&&1!==t&&3!==t&&5!==t||!moment(e).isBefore(moment(),"day")?2===t?"complete-task-title":"":"late-task-title"}}),e.filter("displayTimeFrom",function(){return function(e){return moment(e).fromNow()}}),e.filter("displayUserName",function(){return function(e,t){if(!e||"undefined"==typeof e)return t;if(e){var n=e.first_name?" "+e.first_name:"",a=e.last_name?e.last_name:"",r=e.middle_name?" "+e.middle_name:" ";return a+r+n}return""}}),e.filter("filterTaskProjectName",function(){return function(e){var t=$(".task-list-panel").width()-200;console.log("label widht",t);var n=t/6-3,a="";return a=e.length>n?e.substr(0,n)+"...":e}})}(),tamagoApp.directive("handelActivedNav",handelActivedNav),tamagoApp.directive("editDocument",["$uibModal",editDocument]),tamagoApp.directive("showDocument",["$uibModal",showDocument]),tamagoApp.directive("itemOrganization",function(){return{restrict:"E",replace:!0,scope:{organization:"="},templateUrl:"app/shared/layout/item-organization.html",link:function(e){}}}).directive("itemDependency",function(){return{restrict:"E",replace:!0,scope:{task:"="},templateUrl:"app/shared/layout/item-dependency.html",link:function(e){}}}).directive("itemMember",function(){return{restrict:"E",replace:!0,scope:{member:"="},templateUrl:"app/shared/layout/item-member.html",link:function(e){}}}).directive("projectSearch",function(){return{restrict:"E",scope:{search:"="},templateUrl:"app/components/projects/project-search.html",link:function(e){}}}).directive("projectReportSearch",function(){return{restrict:"E",scope:{search:"="},templateUrl:"app/components/projects/project-report-search.html",link:function(e){}}}).directive("weekForExportReport",function(){return{restrict:"E",replace:!0,scope:{weeks:"="},templateUrl:"app/components/reports/week-for-export-report.html",link:function(e){}}}).directive("historyWeekExportReport",function(){return{restrict:"E",replace:!0,scope:{histories:"="},templateUrl:"app/components/reports/history-week-export-report.html",link:function(e){}}}).directive("yearExportReport",function(){return{restrict:"E",replace:!0,scope:{years:"="},templateUrl:"app/components/reports/year-export-report.html",link:function(e){}}}).directive("whenScrolled",function(){return function(e,t,n){var a=t[0];t.bind("scroll",function(){a.scrollTop+a.offsetHeight>=a.scrollHeight&&e.$apply(n.whenScrolled)})}}).directive("commentScrolled",function(){return function(e,t,n){var a=t[0];t.bind("scroll",function(){0===a.scrollTop&&e.$apply(n.commentScrolled)})}}).directive("clickOutside",["$document",function(e){return{restrict:"A",link:function(e,t,n,a){$(document).click(function(e){var t=$("input[name='keyWord']"),n=$(".search-results"),a=$(".navbar-menu");a.is(e.target)||0!==a.has(e.target).length||t.is(e.target)||0!==t.has(e.target).length?n.show():n.hide()})}}}]).directive("clickOutsideExportReport",["$document",function(e){return{restrict:"A",link:function(e,t,n,a){$(document).click(function(e){var t=$("input[ng-model='myKeywordReportProject']"),n=$(".search-results-rp-project");!t.is(e.target)&&t.is(":visible")&&n.hide()})}}}]).directive("clickOutsideWeekList",["$document",function(e){return{restrict:"A",link:function(e,t,n,a){$(document).click(function(e){var t=$(".area-er-select-weekly"),n=$(".select-week-dropdown");!t.is(e.target)&&t.is(":visible")&&n.hide()})}}}]).directive("clickOutsideYearList",["$document",function(e){return{restrict:"A",link:function(e,t,n,a){$(document).click(function(e){var t=$(".area-er-select-year"),n=$(".select-year-dropdown");!t.is(e.target)&&t.is(":visible")&&(console.log(t),n.hide())})}}}]).directive("weekReportClickOutside",["$document",function(e){return{restrict:"A",link:function(e,t,n,a){$(document).click(function(e){var t=$(".report-year-select"),n=$(".select-year-dropdown");t.is(e.target)||n.hide();var a=$(".report-week-select"),r=$(".select-week-dropdown");!a.is(e.target)&&a.is(":visible")&&r.hide()})}}}]).directive("projectInfor",function(){return{restrict:"E",scope:{project:"="},templateUrl:"app/components/projects/project-info.html",controller:"projectInfoController"}}).directive("projectTask",function(){return{restrict:"E",scope:{task:"="},templateUrl:"app/components/projects/project-task.html"}}).directive("documentList",function(){return{restrict:"E",scope:{documents:"="},templateUrl:"app/components/projects/document-list.html"}}).directive("fileread",["$parse","$rootScope",function(e,t){return{link:function(e,n,a){n.bind("change",function(a){var r=n[0].files[0].type;if(/images*/i.test(r)){t.$broadcast("event-upload",n[0].files[0]);var o=new FileReader;o.onload=function(t){e.fileurl=t.target.result,$("#thumbnail-project").attr("src",e.fileurl)},o.readAsDataURL(a.target.files[0])}else t.$broadcast("event-error","Ch? du?c ch?n ?nh")})}}}]).directive("listTask",function(){return{restrict:"E",scope:{member:"="},templateUrl:"app/components/tasks/info-assign.html",link:function(e,t){}}}).directive("childrenTasks",function(){return{restrict:"E",scope:{children:"="},templateUrl:"app/components/tasks/children-task.html"}}).directive("assignTask",function(){return{restrict:"E",scope:{member:"="},templateUrl:"app/components/tasks/info-assign.html"}}).directive("listTask",function(){return{restrict:"E",scope:{member:"="},templateUrl:"app/components/tasks/info-assign.html",link:function(e,t){}}}).directive("taskInfor",function(){return{restrict:"E",scope:{task:"="},templateUrl:"app/components/tasks/task-info.html"}}).directive("myTaskInfor",function(){return{restrict:"E",scope:{task:"="},templateUrl:"app/components/tasks/my-task-info.html"}}).directive("selectWeek",["weekSelectService",function(weekSelectService){var weekSelectController=["$scope",function WeekSelectCotroller($scope){function getWeekNumber(e){var e=new Date(+e);e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1),n=Math.ceil(((e-t)/864e5+1)/7);return[e.getFullYear(),n]}function getStartDateOfWeek(e,t){var n=new Date(t,0,1+7*(e-1)),a=n.getDay(),r=n;return a<=4?r.setDate(n.getDate()-n.getDay()+1):r.setDate(n.getDate()+8-n.getDay()),r}function getEndDateOfWeek(e,t){var n=getStartDateOfWeek(e,t);return n.setDate(n.getDate()+6)}function getDateRangeOfWeek(weekNo,year,firstOrLastDate){var startDate=getStartDateOfWeek(weekNo,year),rangeIsFrom=startDate.getDate()+"/"+eval(startDate.getMonth()+1)+"/"+startDate.getFullYear();startDate.setDate(startDate.getDate()+6);var rangeIsTo=startDate.getDate()+"/"+eval(startDate.getMonth()+1)+"/"+startDate.getFullYear();return"last"==firstOrLastDate?rangeIsTo:rangeIsFrom}function weeksInYear(e){var t=new Date(e,11,31),n=getWeekNumber(t)[1];return 1==n?getWeekNumber(t.setDate(24))[1]:n}function fnSetWeekSelected(){var e=$scope.objWeekSelected.weekNumber,t=$scope.objWeekSelected.fromDate,n=$scope.objWeekSelected.toDate;$(".p-number-week").html("Tuần "+e),$(".p-fromto-week").html("Từ "+t+" đến "+n),$(".report-week-contain .select-week-dropdown").css("display","none")}function fnSetYearSelected(){var e=$scope.objYearSelected.yearNumber;$(".p-year").html(e),$(".report-week-contain .select-year-dropdown").css("display","none")}$scope.objWeekSelected={},$scope.objYearSelected={},$scope.weeksExportReportResults=[],$scope.historiesExportReportResults=[],$scope.yearsExportReportResults=[],$scope.error=!1,$scope.weekSelected=weekSelectService.weekSelected,$scope.getListOfAllWeeksOfYear=function(e){$scope.objWeekSelected=null,$scope.weeksExportReportResults.length>0&&($scope.weeksExportReportResults=[]),$(".select-week-dropdown li ul week-for-export-report").children().remove();var t=new Date,n=t.getFullYear(),a=moment().week();"undefined"!=typeof e&&e!=n&&(a=weeksInYear(e),n=e),$scope.objYearSelected.yearNumber=n;for(var r=a;r>=1;r--){var o={};o.weekNumber=r,o.fromDate=getDateRangeOfWeek(r,n,"first"),o.toDate=getDateRangeOfWeek(r,n,"last"),$scope.weeksExportReportResults.push(o),r===$scope.weekSelected.week&&($scope.objWeekSelected=o)}$scope.objWeekSelected||($scope.objWeekSelected=$scope.weeksExportReportResults[0]),fnSetWeekSelected()},$scope.getListOfYearsFromNow=function(){for(var e=(new Date).getFullYear(),t=e;t>=e-10;t--){var n={};n.yearNumber=t,$scope.yearsExportReportResults.push(n)}},$scope.tapShowSelectWeek=function(){$(".report-week-contain .select-week-dropdown").toggle()},$scope.tapShowSelectYear=function(){$(".report-week-contain .select-year-dropdown").toggle()},$scope.tapSelectYear=function(e){$scope.objYearSelected=e,fnSetYearSelected(),$scope.weekSelected.year=e.yearNumber,$scope.getListOfAllWeeksOfYear(e.yearNumber)},$scope.tapWeekNumber=function(e){$scope.objWeekSelected=e,$scope.weekSelected.week=e.weekNumber,fnSetWeekSelected()}}];return{restrict:"E",controller:weekSelectController,replace:!0,scope:{weekSelected:"=weekSelected"},templateUrl:"app/shared/layout/week-select.html",link:function(e,t,n){"true"==n.disabled?($(".report-week-select").css("pointer-events","none"),$(".report-year-select").css("pointer-events","none")):($(".report-week-select").css("pointer-events","auto"),$(".report-year-select").css("pointer-events","auto"));var a=e.weekSelected.year;a&&"number"==typeof a?e.getListOfAllWeeksOfYear(a):e.getListOfAllWeeksOfYear(),e.getListOfYearsFromNow()}}}]).directive("checkAvatarImage",["$http",function(e){return{restrict:"A",link:function(t,n,a){a.$observe("ngSrc",function(t){t?e.get(t).success(function(){}).error(function(e){e&&n.attr("src","./assets/img/icons/default_avatar.png")}):n.attr("src","./assets/img/icons/default_avatar.png")})}}}]).directive("notification",["$timeout",function(e){return{restrict:"E",replace:!0,scope:{ngModel:"="},template:'<div class="alert alert-success display-new-task" bs-alert="ngModel"></div>',link:function(t,n,a){e(function(){n.hide()},9e3)}}}]),handelActivedNav.$inject=["$state"];var domain="https://tamago.work:8090/";tamagoApp.constant("URL_VALUES",{LOGIN:domain+"auth/login",LOGOUT:domain+"auth/logout",TASKS:domain+"tasks",PROJECTS:domain+"projects",
TASKS_LIST:domain+"tasks",USERS:domain+"users",DOCUMENTS:domain+"documents",ORGANIZATIONS:domain+"organizations",TASKTEMPLATES:domain+"tasktemplates",TASKDEPENDENCIES:domain+"dependencies",REPORT_EXPORT:domain+"export",DEPARTMENTS:domain+"users/department-position"}),function(){var e=angular.module("simplePagination",[]);e.factory("Pagination",function(){var e={};return e.getNew=function(e){e=void 0===e?5:e;var t={numPages:1,perPage:e,page:0};return t.prevPage=function(){t.page-=1},t.nextPage=function(){t.page+=1},t.toPageId=function(e){t.page=e},t},e}),e.filter("startFrom",function(){return function(e,t){return void 0===e?e:e.slice(+t)}}),e.filter("range",function(){return function(e,t){t=parseInt(t);for(var n=0;n<t;n++)e.push(n);return e}})}();